---
title: "Tjedan 10: Testiranje hipoteza"
subtitle: "Kako donijeti odluku na temelju podataka"
date: 2025-04-26
categories: [testiranje hipoteza, p-vrijednost, t-test, greÅ¡ke tipa I i II, veliÄina uÄinka]
draft: false
---

```{r}
#| label: setup
#| echo: true
#| message: false
#| warning: false

library(tidyverse)
```

::: {.callout-note}
## Ishodi uÄenja

Nakon ovog predavanja moÄ‡i Ä‡ete

1. Formulirati nultu i alternativnu hipotezu za istraÅ¾ivaÄko pitanje.
2. Objasniti logiku testiranja hipoteza kroz analogiju sa suÄ‘enjem.
3. IzraÄunati i interpretirati testnu statistiku i p-vrijednost.
4. Provesti jednosmjerni i dvosmjerni t-test u R-u pomoÄ‡u `t.test()`.
5. Objasniti razliku izmeÄ‘u greÅ¡ke tipa I i greÅ¡ke tipa II.
6. IzraÄunati i interpretirati Cohenov d kao mjeru veliÄine uÄinka.
7. Objasniti koncept statistiÄke snage i faktore koji na nju utjeÄu.
8. KritiÄki ocijeniti statistiÄku znaÄajnost u kontekstu praktiÄne vaÅ¾nosti.
:::

## Motivacija: A/B test na Instagramu

Radite kao analitiÄar u redakciji medijske kuÄ‡e. Urednica vas pita: "Imamo li dokaz da carousel objave generiraju veÄ‡i angaÅ¾man od obiÄnih slika?" Zadnjih nekoliko mjeseci objavljujete oba formata i sada imate podatke.

Prosjek angaÅ¾mana za carousel je 10.1%. Za obiÄne slike je 7.5%. Razlika postoji. Ali je li to prava razlika ili samo posljedica sluÄajnosti? MoÅ¾da bismo, da ponovimo eksperiment, dobili obrnuti rezultat?

Ovo je temeljno pitanje testiranja hipoteza: je li opaÅ¾ena razlika dovoljno velika da iskljuÄimo sluÄajnost kao objaÅ¡njenje?

```{r}
#| label: ucitavanje
#| echo: true
#| message: false
#| warning: false

ig <- read_csv("../resources/datasets/instagram_ab_test.csv")
glimpse(ig)
```

```{r}
#| label: opisna-statistika
#| echo: true
#| message: false
#| warning: false

ig |>
  group_by(format) |>
  summarise(
    n = n(),
    M_engagement = round(mean(engagement_rate) * 100, 2),
    SD_engagement = round(sd(engagement_rate) * 100, 2),
    M_likes = round(mean(likes), 1),
    M_comments = round(mean(comments), 1),
    .groups = "drop"
  )
```

Carousel objave imaju viÅ¡i angaÅ¾man u prosjeku. Ali svaka grupa ima i vlastitu varijabilnost. Pitanje je: kolika je Å¡ansa da bismo vidjeli ovakvu ili veÄ‡u razliku i da carousel zapravo NIJE bolji?

---

## Logika testiranja hipoteza {#sec-logika}

Testiranje hipoteza slijedi logiku koja je sliÄna suÄ‘enju u kaznenom pravu.

Na sudu, optuÅ¾enik je nevin dok se ne dokaÅ¾e krivnja. Ne trebate dokazati nevinost. Trebate dokazati krivnju izvan razumne sumnje. Ako nema dovoljno dokaza, presuda je "nedokazano" (ne "nevin").

U statistici, poÄetna pretpostavka je da nema uÄinka (nema razlike, nema veze). Ovu pretpostavku zovemo **nulta hipoteza** (Hâ‚€). IstraÅ¾ivaÄ pokuÅ¡ava prikupiti dovoljno dokaza da odbaci nultu hipotezu u korist **alternativne hipoteze** (Hâ‚) koja tvrdi da uÄinak postoji.

Za naÅ¡ Instagram primjer:

**Hâ‚€**: Nema razlike u angaÅ¾manu izmeÄ‘u carousel i single image formata. Svaka opaÅ¾ena razlika je posljedica sluÄajnosti.

**Hâ‚**: Postoji razlika u angaÅ¾manu izmeÄ‘u dva formata. OpaÅ¾ena razlika odraÅ¾ava stvarnu razliku u populaciji.

MatematiÄki:

$$H_0: \mu_{carousel} = \mu_{single}$$
$$H_1: \mu_{carousel} \neq \mu_{single}$$

::: {.callout-important}
## VaÅ¾na napomena

Nulta hipoteza uvijek sadrÅ¾i znak jednakosti (= ili â‰¤ ili â‰¥). Alternativna hipoteza sadrÅ¾i znak nejednakosti (â‰  ili > ili <). Nikad obrnuto. Testiramo nultu hipotezu i traÅ¾imo dokaze protiv nje.
:::

---

## Od hipoteze do odluke: korak po korak {#sec-koraci}

Cijeli postupak testiranja hipoteza ima pet koraka.

**Korak 1**: Postavite hipoteze (Hâ‚€ i Hâ‚).

**Korak 2**: Odaberite razinu znaÄajnosti (Î±). To je prag ispod kojeg Ä‡ete odbaciti Hâ‚€. Konvencija je Î± = 0.05 (5%).

**Korak 3**: IzraÄunajte testnu statistiku iz podataka.

**Korak 4**: IzraÄunajte p-vrijednost (vjerojatnost dobivanja ovakve ili ekstremnije testne statistike pod pretpostavkom da je Hâ‚€ istinita).

**Korak 5**: Donesite odluku. Ako je p < Î±, odbacite Hâ‚€. Ako je p â‰¥ Î±, ne moÅ¾ete odbaciti Hâ‚€.

Krenimo korak po korak na jednostavnijem primjeru prije nego se vratimo na Instagram podatke.

---

## JednouzoraÄki t-test {#sec-one-sample}

PoÄnimo s najjednostavnijim sluÄajem: imamo jedan uzorak i Å¾elimo testirati je li prosjek jednak nekoj zadanoj vrijednosti.

Situacija: medijska kuÄ‡a tvrdi da njihovi korisnici provode prosjeÄno 3 minute ÄitajuÄ‡i Älanak. Vi ste skeptiÄni i mislite da je stvarno vrijeme Äitanja drugaÄije. Provedete mjerenje na uzorku Älanaka.

```{r}
#| label: one-sample-podaci
#| echo: true
#| message: false
#| warning: false

set.seed(42)

# Simulirani podaci: stvarno prosjeÄno vrijeme je 2.6 minuta
vrijeme_citanja <- tibble(
  clanak_id = 1:45,
  minuta = round(rnorm(45, mean = 2.6, sd = 0.9), 1)
)

# Opisna statistika
vrijeme_citanja |>
  summarise(
    n = n(),
    M = round(mean(minuta), 2),
    SD = round(sd(minuta), 2),
    SE = round(sd(minuta) / sqrt(n()), 3)
  )
```

Prosjek uzorka je ispod 3 minute. Ali je li dovoljno daleko od 3 da moÅ¾emo odbaciti tvrdnju medijske kuÄ‡e?

### Testna statistika

Testna statistika za jednouzoraÄki t-test je:

$$t = \frac{\bar{x} - \mu_0}{SE} = \frac{\bar{x} - \mu_0}{s / \sqrt{n}}$$

Ovo mjeri koliko je prosjek uzorka udaljen od pretpostavljene vrijednosti, u jedinicama standardne pogreÅ¡ke.

```{r}
#| label: t-stat-rucno
#| echo: true
#| message: false
#| warning: false

x_bar <- mean(vrijeme_citanja$minuta)
mu_0 <- 3  # tvrdnja medijske kuÄ‡e
s <- sd(vrijeme_citanja$minuta)
n <- nrow(vrijeme_citanja)
se <- s / sqrt(n)

t_stat <- (x_bar - mu_0) / se

cat("xÌ„ =", round(x_bar, 2), "\n")
cat("Î¼â‚€ =", mu_0, "\n")
cat("SE =", round(se, 3), "\n")
cat("t =", round(t_stat, 3), "\n")
cat("df =", n - 1, "\n")
```

Testna statistika t je negativna jer je prosjek uzorka manji od pretpostavljene vrijednosti. Apsolutna vrijednost |t| govori koliko standardnih pogreÅ¡aka je prosjek udaljen od Î¼â‚€. Å to veÄ‡i |t|, to jaÄi dokaz protiv Hâ‚€.

### P-vrijednost

**P-vrijednost** je vjerojatnost dobivanja testne statistike jednake ili ekstremnije od opaÅ¾ene, pod pretpostavkom da je Hâ‚€ istinita. To nije vjerojatnost da je Hâ‚€ istinita. To nije vjerojatnost da smo pogrijeÅ¡ili. To je vjerojatnost podataka (ili ekstremnijih) pod Hâ‚€.

```{r}
#| label: p-vrijednost-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

# Dvosmjerni test: gledamo obje strane
p_value <- 2 * pt(abs(t_stat), df = n - 1, lower.tail = FALSE)

x_vals <- seq(-5, 5, length.out = 300)

t_data <- tibble(x = x_vals, density = dt(x_vals, df = n - 1))

ggplot(t_data, aes(x = x, y = density)) +
  geom_line(linewidth = 1) +
  geom_area(data = t_data |> filter(x <= -abs(t_stat)),
            fill = "firebrick", alpha = 0.4) +
  geom_area(data = t_data |> filter(x >= abs(t_stat)),
            fill = "firebrick", alpha = 0.4) +
  geom_vline(xintercept = c(-abs(t_stat), abs(t_stat)), 
             color = "firebrick", linetype = "dashed") +
  annotate("text", x = t_stat - 0.3, y = 0.05, 
           label = paste("t =", round(t_stat, 2)), color = "firebrick", hjust = 1) +
  labs(
    title = "P-vrijednost je crveno osjenÄano podruÄje",
    subtitle = paste0("Dvosmjerni test. p = ", round(p_value, 4), 
                      ". Ako je p < 0.05, odbacujemo Hâ‚€."),
    x = "t-vrijednost",
    y = "GustoÄ‡a"
  ) +
  theme_minimal()
```

```{r}
#| label: p-izracun
#| echo: true
#| message: false
#| warning: false

cat("t-statistika:", round(t_stat, 3), "\n")
cat("P-vrijednost (dvosmjerni):", round(p_value, 4), "\n")
cat("Î± = 0.05\n")
cat("Odluka:", if_else(p_value < 0.05, "Odbacujemo Hâ‚€", "Ne moÅ¾emo odbaciti Hâ‚€"), "\n")
```

### `t.test()` radi sve automatski

```{r}
#| label: t-test-funkcija
#| echo: true
#| message: false
#| warning: false

t.test(vrijeme_citanja$minuta, mu = 3)
```

Funkcija `t.test()` daje sve potrebne informacije: testnu statistiku, stupnjeve slobode, p-vrijednost, interval pouzdanosti i prosjek uzorka. P-vrijednost je ispod 0.05, Å¡to znaÄi da imamo dovoljno dokaza da odbacimo tvrdnju medijske kuÄ‡e da je prosjeÄno vrijeme Äitanja 3 minute.

::: {.callout-tip}
## Veza izmeÄ‘u CI i testiranja hipoteza

Pogledajte 95% CI iz gornjeg rezultata. Ne sadrÅ¾i vrijednost 3. Ovo nije sluÄajnost: odbacivanje Hâ‚€ na razini Î± = 0.05 je ekvivalentno tome da 95% CI ne sadrÅ¾i testiranu vrijednost Î¼â‚€. Ovo su dva naÄina gledanja na isti problem.
:::

---

## Dvosmjerni vs jednosmjerni test {#sec-smjerovi}

U prethodnom primjeru koristili smo **dvosmjerni test** (two-tailed): testirali smo je li prosjek razliÄit od 3, u bilo kojem smjeru. Hipoteze su bile Hâ‚€: Î¼ = 3 vs Hâ‚: Î¼ â‰  3.

Ponekad unaprijed znamo smjer. Ako Instagram tim oÄekuje da su carousel objave BOLJE (ne samo razliÄite), moÅ¾emo koristiti **jednosmjerni test** (one-tailed): Hâ‚€: Î¼_carousel â‰¤ Î¼_single vs Hâ‚: Î¼_carousel > Î¼_single.

```{r}
#| label: smjerovi-demo
#| echo: true
#| message: false
#| warning: false

# Jednosmjerni: je li prosjek MANJI od 3?
t.test(vrijeme_citanja$minuta, mu = 3, alternative = "less")
```

P-vrijednost jednosmjernog testa je toÄno pola dvosmjernog (kad je smjer u skladu s podacima). Jednosmjerni test je "osjetljiviji" u tom smjeru, ali potpuno slijep za razliku u suprotnom smjeru.

::: {.callout-warning}
## Upozorenje

Jednosmjerni test koristite SAMO ako ste smjer hipoteze odredili PRIJE nego ste pogledali podatke. Ako pogledate podatke, vidite da je prosjek manji od 3 i onda odluÄite testirati "je li manji", to je pristranost istraÅ¾ivaÄa. Kad ste u sumnji, koristite dvosmjerni test. VeÄ‡ina publiciranih istraÅ¾ivanja koristi dvosmjerne testove.
:::

---

## DvouzoraÄki t-test: Instagram A/B test {#sec-two-sample}

Sada se vraÄ‡amo na naÅ¡ motivacijski primjer. Å½elimo testirati razlikuje li se angaÅ¾man izmeÄ‘u carousel i single image objava. Ovo zahtijeva **dvouzoraÄki t-test** (two-sample t-test) jer usporeÄ‘ujemo prosjeke dviju nezavisnih skupina.

$$H_0: \mu_{carousel} = \mu_{single}$$
$$H_1: \mu_{carousel} \neq \mu_{single}$$

```{r}
#| label: two-sample-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

ig |>
  ggplot(aes(x = engagement_rate * 100, fill = format)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = ig |> group_by(format) |> summarise(M = mean(engagement_rate) * 100),
             aes(xintercept = M, color = format), linewidth = 1, linetype = "dashed") +
  scale_fill_manual(values = c("carousel" = "#2a9d8f", "single_image" = "#e76f51")) +
  scale_color_manual(values = c("carousel" = "#2a9d8f", "single_image" = "#e76f51")) +
  labs(
    title = "Distribucija angaÅ¾mana po formatu objave",
    subtitle = "Isprekidane linije = prosjeci. Distribucije se preklapaju ali su centri razliÄiti.",
    x = "Engagement rate (%)",
    y = "GustoÄ‡a",
    fill = "Format", color = "Format"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Distribucije se preklapaju, ali carousel objave su pomaknute udesno. Testna statistika za dvouzoraÄki t-test mjeri razliku prosjeka u jedinicama zajedniÄke standardne pogreÅ¡ke:

$$t = \frac{\bar{x}_1 - \bar{x}_2}{SE_{razlika}}$$

```{r}
#| label: two-sample-test
#| echo: true
#| message: false
#| warning: false

carousel <- ig |> filter(format == "carousel") |> pull(engagement_rate)
single <- ig |> filter(format == "single_image") |> pull(engagement_rate)

rezultat <- t.test(carousel, single)
rezultat
```

```{r}
#| label: two-sample-interpretacija
#| echo: true
#| message: false
#| warning: false

cat("Razlika prosjeka:", round((mean(carousel) - mean(single)) * 100, 2), "postotnih bodova\n")
cat("t-statistika:", round(rezultat$statistic, 2), "\n")
cat("P-vrijednost:", format(rezultat$p.value, scientific = TRUE), "\n")
cat("95% CI za razliku: [", round(rezultat$conf.int[1] * 100, 2), ",", 
    round(rezultat$conf.int[2] * 100, 2), "] postotnih bodova\n")
```

P-vrijednost je iznimno mala (mnogo manja od 0.05). Imamo snaÅ¾ne dokaze da se angaÅ¾man razlikuje izmeÄ‘u dva formata. Carousel objave imaju statistiÄki znaÄajno viÅ¡i angaÅ¾man.

### Welchov t-test

R po defaultu koristi **Welchov t-test** koji ne pretpostavlja jednake varijance u dvjema skupinama. Ovo je gotovo uvijek bolja opcija od klasiÄnog Studentovog t-testa (koji pretpostavlja jednake varijance). Welchov test je robusniji i gubi malo snage Äak i kad su varijance jednake.

```{r}
#| label: welch-vs-student
#| echo: true
#| message: false
#| warning: false

# Welchov (default)
welch <- t.test(carousel, single, var.equal = FALSE)

# Studentov (pretpostavlja jednake varijance)
student <- t.test(carousel, single, var.equal = TRUE)

tibble(
  test = c("Welch (default)", "Student (var.equal=TRUE)"),
  t = round(c(welch$statistic, student$statistic), 3),
  df = round(c(welch$parameter, student$parameter), 1),
  p = format(c(welch$p.value, student$p.value), scientific = TRUE, digits = 3)
)
```

Rezultati su vrlo sliÄni u ovom sluÄaju. Ali Welchov test ima nerunde stupnjeve slobode (jer ih prilagoÄ‘ava za razliku u varijancama). Koristite Welchov test kao default jer ne zahtijeva dodatnu pretpostavku.

---

## Simulacija: Å¡to znaÄi p-vrijednost? {#sec-simulacija-p}

Mnogi studenti (i istraÅ¾ivaÄi) krivo razumiju p-vrijednost. Simulacija pomaÅ¾e izgraditi ispravnu intuiciju.

Pretpostavimo da Hâ‚€ JEST istinita: carousel i single image imaju identiÄan angaÅ¾man. Ako mnogo puta uzorkujemo i testiramo, koliko Ä‡emo Äesto dobiti p < 0.05?

```{r}
#| label: simulacija-h0-istinita
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

set.seed(42)

# Simulacija: Hâ‚€ je ISTINITA (isti prosjek za obje grupe)
sim_p <- map_dbl(1:10000, \(i) {
  grupa_a <- rnorm(100, mean = 0.08, sd = 0.02)
  grupa_b <- rnorm(100, mean = 0.08, sd = 0.02)  # ISTI prosjek!
  t.test(grupa_a, grupa_b)$p.value
})

cat("Hâ‚€ je ISTINITA. Od 10 000 testova:\n")
cat("p < 0.05:", sum(sim_p < 0.05), "(", round(mean(sim_p < 0.05) * 100, 1), "%)\n")
cat("p < 0.01:", sum(sim_p < 0.01), "(", round(mean(sim_p < 0.01) * 100, 1), "%)\n")

tibble(p = sim_p) |>
  ggplot(aes(x = p)) +
  geom_histogram(fill = "steelblue", color = "white", bins = 50) +
  geom_vline(xintercept = 0.05, color = "firebrick", linewidth = 1, linetype = "dashed") +
  annotate("text", x = 0.06, y = 400, label = "Î± = 0.05", color = "firebrick", hjust = 0) +
  labs(
    title = "Distribucija p-vrijednosti kad je Hâ‚€ ISTINITA",
    subtitle = "P-vrijednosti su uniformno rasporeÄ‘ene. ~5% pada ispod 0.05.",
    x = "P-vrijednost",
    y = "Frekvencija"
  ) +
  theme_minimal()
```

Kad je Hâ‚€ istinita, p-vrijednosti su uniformno rasporeÄ‘ene izmeÄ‘u 0 i 1. ToÄno 5% pada ispod 0.05 (po definiciji Î±). Ovo znaÄi da Ä‡emo u 5% sluÄajeva pogreÅ¡no odbaciti Hâ‚€ Äak i kad je istinita. Ovo je **greÅ¡ka tipa I** (false positive, laÅ¾no pozitivni rezultat).

### Kad je Hâ‚ istinita

```{r}
#| label: simulacija-h1-istinita
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

set.seed(42)

# Simulacija: Hâ‚ je ISTINITA (razlika postoji)
sim_p_h1 <- map_dbl(1:10000, \(i) {
  grupa_a <- rnorm(100, mean = 0.10, sd = 0.02)
  grupa_b <- rnorm(100, mean = 0.08, sd = 0.02)  # RAZLIÄŒIT prosjek
  t.test(grupa_a, grupa_b)$p.value
})

cat("Hâ‚ je ISTINITA (razlika = 0.02). Od 10 000 testova:\n")
cat("p < 0.05:", sum(sim_p_h1 < 0.05), "(", round(mean(sim_p_h1 < 0.05) * 100, 1), "%)\n")

tibble(p = sim_p_h1) |>
  ggplot(aes(x = p)) +
  geom_histogram(fill = "#2a9d8f", color = "white", bins = 50) +
  geom_vline(xintercept = 0.05, color = "firebrick", linewidth = 1, linetype = "dashed") +
  labs(
    title = "Distribucija p-vrijednosti kad je Hâ‚ ISTINITA",
    subtitle = "VeÄ‡ina p-vrijednosti je blizu nule. Test je imao snagu detektirati razliku.",
    x = "P-vrijednost",
    y = "Frekvencija"
  ) +
  theme_minimal()
```

Kad razlika stvarno postoji, p-vrijednosti su koncentrirane blizu nule. VeÄ‡ina testova uspjeÅ¡no detektira razliku (p < 0.05). Ali ne svi. Postotak testova koji uspjeÅ¡no detektiraju pravu razliku naziva se **statistiÄka snaga** (power). Testovi koji ne detektiraju pravu razliku (p â‰¥ 0.05 iako razlika postoji) Äine **greÅ¡ku tipa II** (false negative, laÅ¾no negativni rezultat).

---

## GreÅ¡ka tipa I i greÅ¡ka tipa II {#sec-greske}

Postoje Äetiri moguÄ‡a ishoda testiranja hipoteza, ovisno o tome je li Hâ‚€ stvarno istinita i kakvu smo odluku donijeli.

```{r}
#| label: tablica-odluka
#| echo: true
#| message: false
#| warning: false

tribble(
  ~` `, ~`Hâ‚€ je istinita`, ~`Hâ‚€ je laÅ¾na`,
  "Ne odbacujemo Hâ‚€", "âœ… Ispravna odluka (1 - Î±)", "âŒ GreÅ¡ka tipa II (Î²)",
  "Odbacujemo Hâ‚€", "âŒ GreÅ¡ka tipa I (Î±)", "âœ… Ispravna odluka (snaga = 1 - Î²)"
)
```

**GreÅ¡ka tipa I** (Î±): Odbacimo Hâ‚€ iako je istinita. ZakljuÄimo da razlika postoji kad je zapravo nema. Kontroliramo je postavljanjem Î± (obiÄno 0.05). Analogija sa suÄ‘enjem: osuditi nevinu osobu.

**GreÅ¡ka tipa II** (Î²): Ne odbacimo Hâ‚€ iako je laÅ¾na. Propustimo pravu razliku. Ovisi o veliÄini uzorka, veliÄini uÄinka i Î±. Analogija sa suÄ‘enjem: osloboditi krivca.

```{r}
#| label: greske-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 10
#| fig-height: 5

x <- seq(-4, 8, length.out = 500)
h0 <- dnorm(x, mean = 0, sd = 1)
h1 <- dnorm(x, mean = 3, sd = 1)

crit <- qnorm(0.975)

error_data <- tibble(x = x, H0 = h0, H1 = h1)

ggplot(error_data, aes(x = x)) +
  # H0 distribucija
  geom_line(aes(y = H0), color = "steelblue", linewidth = 1) +
  geom_area(data = error_data |> filter(x >= crit), aes(y = H0),
            fill = "firebrick", alpha = 0.3) +
  # H1 distribucija
  geom_line(aes(y = H1), color = "#2a9d8f", linewidth = 1) +
  geom_area(data = error_data |> filter(x < crit), aes(y = H1),
            fill = "#e9c46a", alpha = 0.3) +
  # KritiÄna vrijednost
  geom_vline(xintercept = crit, color = "grey30", linewidth = 0.8, linetype = "dashed") +
  annotate("text", x = 0, y = 0.42, label = "Hâ‚€ distribucija", color = "steelblue", fontface = "bold") +
  annotate("text", x = 3, y = 0.42, label = "Hâ‚ distribucija", color = "#2a9d8f", fontface = "bold") +
  annotate("text", x = 2.8, y = 0.12, label = "GreÅ¡ka\ntipa I (Î±)", color = "firebrick") +
  annotate("text", x = 0.5, y = 0.06, label = "GreÅ¡ka\ntipa II (Î²)", color = "#c77f00") +
  annotate("text", x = crit, y = -0.02, label = "KritiÄna\nvrijednost", hjust = 0.5) +
  labs(
    title = "Vizualizacija greÅ¡aka tipa I i tipa II",
    subtitle = "Crveno = laÅ¾no pozitivno. Å½uto = laÅ¾no negativno. Ne moÅ¾emo smanjiti oboje istovremeno.",
    x = "Testna statistika",
    y = "GustoÄ‡a"
  ) +
  theme_minimal()
```

Ovaj graf pokazuje kljuÄan kompromis. Ako pomaknemo kritiÄnu vrijednost udesno (stroÅ¾iji Î±), smanjujemo crveno podruÄje (manje laÅ¾no pozitivnih) ali poveÄ‡avamo Å¾uto podruÄje (viÅ¡e laÅ¾no negativnih). Jedini naÄin da smanjimo oboje istovremeno je poveÄ‡ati uzorak (Å¡to razdvaja dvije distribucije) ili imati veÄ‡i uÄinak.

::: {.callout-important}
## VaÅ¾na napomena

"Ne moÅ¾emo odbaciti Hâ‚€" nije isto Å¡to i "Hâ‚€ je istinita." Odsutnost dokaza nije dokaz odsutnosti. MoÅ¾da razlika postoji ali je naÅ¡ uzorak premalen da je detektira. Zato nikad ne kaÅ¾emo "prihvaÄ‡amo Hâ‚€" nego "ne moÅ¾emo odbaciti Hâ‚€ na temelju dostupnih podataka."
:::

---

## P-vrijednost: Å¡to jest, a Å¡to nije {#sec-p-vrijednost}

P-vrijednost je jedan od najÄeÅ¡Ä‡e koriÅ¡tenih ali i najÄeÅ¡Ä‡e pogreÅ¡no interpretiranih koncepata u statistici. Razjasnimo.

**P-vrijednost JEST**: Vjerojatnost dobivanja testne statistike jednake ili ekstremnije od opaÅ¾ene, pod pretpostavkom da je Hâ‚€ istinita. Drugim rijeÄima: koliko bi bili iznenaÄ‘eni ovakvim podacima kad Hâ‚€ ne bi bila istinita?

**P-vrijednost NIJE**:

P-vrijednost NIJE vjerojatnost da je Hâ‚€ istinita. Ne moÅ¾emo reÄ‡i "postoji samo 3% Å¡anse da nema razlike." P-vrijednost ne govori niÅ¡ta o vjerojatnosti hipoteza.

P-vrijednost NIJE vjerojatnost da smo pogrijeÅ¡ili. Mala p-vrijednost znaÄi da su podaci neobiÄni pod Hâ‚€. Ne znaÄi da smo sigurno u pravu.

P-vrijednost NIJE mjera veliÄine uÄinka. p = 0.001 ne znaÄi da je uÄinak velik. Velik uzorak moÅ¾e proizvesti malu p-vrijednost za trivijalno malu razliku.

```{r}
#| label: p-vs-ucinak
#| echo: true
#| message: false
#| warning: false

set.seed(42)

# Mali uzorak, velik uÄinak
mali_uzorak <- t.test(rnorm(20, 10.5, 2), mu = 10)

# Velik uzorak, siÄ‡uÅ¡an uÄinak
velik_uzorak <- t.test(rnorm(10000, 10.02, 2), mu = 10)

tibble(
  scenarij = c("Mali uzorak (n=20), velik uÄinak", "Velik uzorak (n=10000), siÄ‡uÅ¡an uÄinak"),
  n = c(20, 10000),
  razlika = c("0.5 bodova", "0.02 boda"),
  p_vrijednost = c(round(mali_uzorak$p.value, 4), round(velik_uzorak$p.value, 4)),
  znacajno = c(mali_uzorak$p.value < 0.05, velik_uzorak$p.value < 0.05)
)
```

S 10 000 opaÅ¾anja, razlika od 0.02 boda (praktiÄki beznaÄajna) je statistiÄki znaÄajna. S 20 opaÅ¾anja, razlika od 0.5 bodova (potencijalno vaÅ¾na) nije statistiÄki znaÄajna. Ovo pokazuje zaÅ¡to p-vrijednost sama nije dovoljna. Uvijek trebamo i mjeru veliÄine uÄinka.

---


::: {.callout-note}
## Podsjetnik

U prvom dijelu nauÄili smo logiku testiranja hipoteza, formuliranje Hâ‚€ i Hâ‚, jednouzoraÄki i dvouzoraÄki t-test, p-vrijednost i greÅ¡ke tipa I i II. U ovom dijelu prelazimo na pitanje koje je jednako vaÅ¾no kao statistiÄka znaÄajnost: koliko je uÄinak zapravo velik?
:::

## VeliÄina uÄinka: Cohenov d {#sec-cohen-d}

P-vrijednost odgovara na pitanje "postoji li uÄinak?" ali ne govori koliko je uÄinak velik. Za to nam treba mjera **veliÄine uÄinka** (effect size).

NajÄeÅ¡Ä‡a mjera za razliku dvaju prosjeka je **Cohenov d**, koji izraÅ¾ava razliku u jedinicama zajedniÄke standardne devijacije:

$$d = \frac{\bar{x}_1 - \bar{x}_2}{s_{pooled}}$$

gdje je $s_{pooled}$ zajedniÄka (pooled) standardna devijacija dviju grupa.

```{r}
#| label: cohen-d-rucno
#| echo: true
#| message: false
#| warning: false

ig <- read_csv("../resources/datasets/instagram_ab_test.csv")

carousel <- ig |> filter(format == "carousel") |> pull(engagement_rate)
single <- ig |> filter(format == "single_image") |> pull(engagement_rate)

# RuÄni izraÄun
n1 <- length(carousel)
n2 <- length(single)
s_pooled <- sqrt(((n1 - 1) * sd(carousel)^2 + (n2 - 1) * sd(single)^2) / (n1 + n2 - 2))
d <- (mean(carousel) - mean(single)) / s_pooled

cat("Razlika prosjeka:", round((mean(carousel) - mean(single)) * 100, 2), "postotnih bodova\n")
cat("Pooled SD:", round(s_pooled * 100, 2), "postotnih bodova\n")
cat("Cohenov d:", round(d, 3), "\n")
```

### Interpretacija Cohenovog d

Cohen (1988) je predloÅ¾io smjernice za interpretaciju:

```{r}
#| label: cohen-smjernice
#| echo: true
#| message: false
#| warning: false

tribble(
  ~d, ~interpretacija, ~primjer,
  "0.2", "Mali uÄinak", "Jedva primjetna razlika u praksi",
  "0.5", "Srednji uÄinak", "Razlika vidljiva prostim okom",
  "0.8", "Veliki uÄinak", "Razlika oÄita i praktiÄno vaÅ¾na"
)
```

NaÅ¡ d = `r round(d, 2)` je velik uÄinak. Carousel objave generiraju znaÄajno viÅ¡i angaÅ¾man, i to u praktiÄno vaÅ¾noj mjeri. Ovo je informacija koju p-vrijednost sama ne daje.

```{r}
#| label: cohen-d-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 10
#| fig-height: 8

# Vizualizacija: Å¡to znaÄi d = 0.2, 0.5, 0.8, 1.3
d_values <- c(0.2, 0.5, 0.8, round(d, 2))
d_labels <- c("d = 0.2 (mali)", "d = 0.5 (srednji)", "d = 0.8 (veliki)", 
              paste0("d = ", round(d, 2), " (naÅ¡i podaci)"))

x <- seq(-4, 6, length.out = 300)

d_viz <- map_df(seq_along(d_values), \(i) {
  tibble(
    panel = d_labels[i],
    x = x,
    Grupa_A = dnorm(x, 0, 1),
    Grupa_B = dnorm(x, d_values[i], 1)
  ) |>
    pivot_longer(c(Grupa_A, Grupa_B), names_to = "grupa", values_to = "gustoca")
}) |>
  mutate(panel = factor(panel, levels = d_labels))

d_viz |>
  ggplot(aes(x = x, y = gustoca, fill = grupa)) +
  geom_area(alpha = 0.4, position = "identity") +
  facet_wrap(~panel, ncol = 2) +
  scale_fill_manual(values = c("Grupa_A" = "steelblue", "Grupa_B" = "#2a9d8f"),
                    labels = c("Grupa A", "Grupa B")) +
  labs(
    title = "Å to znaÄi Cohenov d?",
    subtitle = "VeÄ‡i d = manje preklapanja izmeÄ‘u distribucija = oÄitija razlika",
    x = "Vrijednost", y = "GustoÄ‡a", fill = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

S d = 0.2, distribucije se gotovo potpuno preklapaju i razliku je teÅ¡ko primijetiti. S d = 0.8, razdvajanje je oÄito. NaÅ¡ d â‰ˆ 1.3 pokazuje vrlo jasno razdvajanje: carousel i single image su oÄigledno razliÄite kategorije po angaÅ¾manu.

::: {.callout-tip}
## PraktiÄni savjet

Uvijek izvjeÅ¡tavajte veliÄinu uÄinka uz p-vrijednost. Umjesto "razlika je statistiÄki znaÄajna (p < 0.001)", napiÅ¡ite "carousel objave imaju znaÄajno viÅ¡i angaÅ¾man od single image objava (razlika = 2.6 postotnih bodova, d = 1.34, p < 0.001)." Ovo daje Äitatelju informaciju i o postojanju i o veliÄini razlike.
:::

---

## StatistiÄka snaga {#sec-snaga}

**StatistiÄka snaga** (power) je vjerojatnost da test odbaci Hâ‚€ kad je Hâ‚ istinita. Drugim rijeÄima: koliko je vjerojatno da Ä‡emo detektirati pravu razliku ako ona postoji?

Snaga ovisi o Äetiri faktora: veliÄini uÄinka (veÄ‡i uÄinak je lakÅ¡e detektirati), veliÄini uzorka (viÅ¡e podataka daje veÄ‡u snagu), razini znaÄajnosti Î± (veÄ‡i Î± daje veÄ‡u snagu ali viÅ¡e laÅ¾no pozitivnih), i varijabilnosti podataka (manja varijabilnost daje veÄ‡u snagu).

Konvencija je da snaga treba biti barem 0.80 (80%). Ovo znaÄi da ako razlika postoji, Å¾elimo je detektirati barem u 8 od 10 pokuÅ¡aja.

### Analiza snage: koliki uzorak trebam?

NajÄeÅ¡Ä‡a primjena analize snage je planiranje istraÅ¾ivanja: koliki uzorak mi treba da detektiram oÄekivanu veliÄinu uÄinka s 80% snagom?

```{r}
#| label: power-izracun
#| echo: true
#| message: false
#| warning: false

# power.t.test() za dvouzoraÄki test
# Koliki uzorak trebam za srednji uÄinak (d = 0.5)?
power.t.test(
  delta = 0.5,       # oÄekivana razlika u SD jedinicama (Cohenov d)
  sd = 1,            # standardizirano na 1
  sig.level = 0.05,  # Î±
  power = 0.80,      # Å¾eljena snaga
  type = "two.sample",
  alternative = "two.sided"
)
```

Za detektiranje srednjeg uÄinka (d = 0.5) s 80% snagom potrebno je otprilike 64 ispitanika po grupi (ukupno 128). Pogledajmo kako se potreban uzorak mijenja s veliÄinom uÄinka.

```{r}
#| label: power-tablica
#| echo: true
#| message: false
#| warning: false

d_values <- c(0.2, 0.3, 0.5, 0.8, 1.0, 1.3)

power_tablica <- map_df(d_values, \(d_val) {
  rez <- power.t.test(delta = d_val, sd = 1, sig.level = 0.05, power = 0.80,
                      type = "two.sample", alternative = "two.sided")
  tibble(
    cohenov_d = d_val,
    n_po_grupi = ceiling(rez$n),
    ukupno_n = ceiling(rez$n) * 2
  )
})

power_tablica
```

Za mali uÄinak (d = 0.2) trebate Äak 394 ispitanika po grupi. Za veliki uÄinak (d = 0.8) trebate samo 26 po grupi. Ovo je razlog zaÅ¡to je planiranje unaprijed kljuÄno: morate imati realistiÄna oÄekivanja o veliÄini uÄinka da biste znali koliko podataka trebate.

```{r}
#| label: power-krivulja
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

# Krivulja snage: kako snaga raste s veliÄinom uzorka
n_range <- seq(10, 300, by = 5)

power_curves <- map_df(c(0.2, 0.5, 0.8), \(d_val) {
  map_df(n_range, \(n_val) {
    p <- power.t.test(n = n_val, delta = d_val, sd = 1, sig.level = 0.05,
                      type = "two.sample", alternative = "two.sided")$power
    tibble(n = n_val, power = p, d = paste("d =", d_val))
  })
})

power_curves |>
  ggplot(aes(x = n, y = power, color = d)) +
  geom_line(linewidth = 1.2) +
  geom_hline(yintercept = 0.80, linetype = "dashed", color = "grey50") +
  annotate("text", x = 290, y = 0.82, label = "Snaga = 0.80", color = "grey50", hjust = 1) +
  scale_y_continuous(labels = scales::label_percent(), limits = c(0, 1)) +
  scale_color_manual(values = c("d = 0.2" = "#e76f51", "d = 0.5" = "#e9c46a", "d = 0.8" = "#2a9d8f")) +
  labs(
    title = "Krivulje snage za dvouzoraÄki t-test",
    subtitle = "VeÄ‡i uÄinak ili veÄ‡i uzorak = veÄ‡a snaga detektiranja razlike",
    x = "VeliÄina uzorka (po grupi)",
    y = "StatistiÄka snaga",
    color = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Za mali uÄinak (d = 0.2, crvena), snaga sporo raste i ni s n = 300 po grupi ne dostiÅ¾e 100%. Za veliki uÄinak (d = 0.8, zelena), snaga brzo raste i s n = 30 po grupi je veÄ‡ blizu 80%.

### Kolika je snaga naÅ¡eg Instagram testa?

```{r}
#| label: power-ig
#| echo: true
#| message: false
#| warning: false

# Kolika je snaga naÅ¡eg testa s d â‰ˆ 1.34 i n â‰ˆ 250 po grupi?
power_ig <- power.t.test(
  n = min(n1, n2),
  delta = d,
  sd = 1,
  sig.level = 0.05,
  type = "two.sample",
  alternative = "two.sided"
)

cat("Snaga naÅ¡eg testa:", round(power_ig$power, 4), "\n")
```

Snaga je gotovo 1.0 (100%). S ovakvom veliÄinom uÄinka i ovako velikim uzorkom, gotovo nema Å¡anse da bismo propustili ovu razliku. Test je bio viÅ¡e nego adekvatno snaÅ¾an. U praksi, mogli smo detektirati ovu razliku s mnogo manje podataka.

```{r}
#| label: power-ig-minimum
#| echo: true
#| message: false
#| warning: false

# Koliki minimalni uzorak bi bio dovoljan?
min_n <- power.t.test(
  delta = d,
  sd = 1,
  sig.level = 0.05,
  power = 0.80,
  type = "two.sample"
)

cat("Minimalni n po grupi za 80% snagu:", ceiling(min_n$n), "\n")
cat("Mi smo imali:", min(n1, n2), "po grupi\n")
```

---

## Upareni t-test {#sec-paired}

Dosad smo usporeÄ‘ivali dvije **nezavisne** skupine (carousel vs single image su razliÄite objave). Ali ponekad mjerimo istu jedinicu u dva uvjeta. Na primjer: angaÅ¾man istih pratitelja prije i poslije redizajna profila, ili rating istih Älanaka od strane dva razliÄita urednika.

Kad su opaÅ¾anja u parovima, koristimo **upareni t-test** (paired t-test). Umjesto da usporeÄ‘ujemo dva prosjeka, raÄunamo razliku za svaki par i testiramo je li prosjek razlika razliÄit od nule.

```{r}
#| label: paired-primjer
#| echo: true
#| message: false
#| warning: false

set.seed(42)

# Simulacija: 30 Älanaka, svaki ocjenjen od 2 urednika
urednicki_rating <- tibble(
  clanak_id = 1:30,
  urednik_A = round(rnorm(30, mean = 6.5, sd = 1.2), 1),
  urednik_B = round(urednik_A + rnorm(30, mean = 0.5, sd = 0.8), 1)
)

# Urednik B ocjenjuje sustavno viÅ¡e
urednicki_rating <- urednicki_rating |>
  mutate(razlika = urednik_B - urednik_A)

urednicki_rating |>
  summarise(
    M_A = round(mean(urednik_A), 2),
    M_B = round(mean(urednik_B), 2),
    M_razlika = round(mean(razlika), 2),
    SD_razlika = round(sd(razlika), 2)
  )
```

```{r}
#| label: paired-test
#| echo: true
#| message: false
#| warning: false

# Upareni t-test
t.test(urednicki_rating$urednik_B, urednicki_rating$urednik_A, paired = TRUE)
```

```{r}
#| label: paired-vs-nepaired
#| echo: true
#| message: false
#| warning: false

# Usporedba: upareni vs nepareni test na istim podacima
paired_p <- t.test(urednicki_rating$urednik_B, urednicki_rating$urednik_A, paired = TRUE)$p.value
unpaired_p <- t.test(urednicki_rating$urednik_B, urednicki_rating$urednik_A, paired = FALSE)$p.value

cat("Upareni test p-vrijednost:  ", round(paired_p, 5), "\n")
cat("Nepareni test p-vrijednost: ", round(unpaired_p, 5), "\n")
```

Upareni test je osjetljiviji (manja p-vrijednost) jer uklanja varijabilnost izmeÄ‘u parova. Neki Älanci su opÄ‡enito bolji, neki loÅ¡iji. Kad to kontroliramo (parenjem), preostaje samo varijabilnost u razlici izmeÄ‘u dva urednika, Å¡to je puno manja.

```{r}
#| label: paired-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

urednicki_rating |>
  ggplot() +
  geom_segment(aes(x = urednik_A, xend = urednik_B, y = clanak_id, yend = clanak_id),
               color = "grey70", linewidth = 0.5) +
  geom_point(aes(x = urednik_A, y = clanak_id), color = "steelblue", size = 2) +
  geom_point(aes(x = urednik_B, y = clanak_id), color = "#e76f51", size = 2) +
  annotate("text", x = 3.5, y = 31, label = "Urednik A", color = "steelblue", fontface = "bold") +
  annotate("text", x = 10, y = 31, label = "Urednik B", color = "#e76f51", fontface = "bold") +
  labs(
    title = "UredniÄke ocjene istih Älanaka",
    subtitle = "Svaka linija je jedan Älanak. Urednik B sustavno ocjenjuje viÅ¡e.",
    x = "Ocjena (1-10)",
    y = "ÄŒlanak ID"
  ) +
  theme_minimal()
```

::: {.callout-important}
## Kada koristiti koji test?

**Nepareni (nezavisni) t-test**: Dvije razliÄite skupine ispitanika. Primjeri: muÅ¡karci vs Å¾ene, kontrolna vs eksperimentalna grupa, carousel vs single image.

**Upareni t-test**: Ista jedinica mjerena dva puta. Primjeri: prije i poslije intervencije, isti sadrÅ¾aj na dva kanala, isti ispitanik u dva uvjeta. KljuÄno pitanje: moÅ¾ete li smisleno spariti opaÅ¾anja? Ako da, koristite upareni test.
:::

---

## StatistiÄka vs praktiÄna znaÄajnost {#sec-prakticna}

StatistiÄka znaÄajnost (p < 0.05) govori da razlika vjerojatno nije sluÄajnost. Ali ne govori je li razlika dovoljno velika da je vaÅ¾na u praksi. Ovo razlikovanje je kljuÄno za donoÅ¡enje odluka.

```{r}
#| label: prakticna-primjer
#| echo: true
#| message: false
#| warning: false

set.seed(42)

# Scenarij 1: StatistiÄki znaÄajno ali praktiÄki beznaÄajno
# Novi dizajn naslovnice poveÄ‡ava CTR s 2.00% na 2.05%
n_velik <- 50000
ctr_stari <- rbinom(n_velik, 1, 0.0200)
ctr_novi <- rbinom(n_velik, 1, 0.0205)

test1 <- t.test(ctr_novi, ctr_stari)

cat("=== Scenarij 1: Velik uzorak, siÄ‡uÅ¡na razlika ===\n")
cat("Razlika CTR:", round((mean(ctr_novi) - mean(ctr_stari)) * 100, 3), "postotnih bodova\n")
cat("P-vrijednost:", round(test1$p.value, 4), "\n")
cat("StatistiÄki znaÄajno:", test1$p.value < 0.05, "\n")
cat("Isplati li se redizajn? Vjerojatno ne.\n\n")

# Scenarij 2: StatistiÄki neznaÄajno ali potencijalno praktiÄki vaÅ¾no
# Novi format poveÄ‡ava CTR s 2.0% na 3.5% ali mali uzorak
n_mali <- 80
ctr_stari2 <- rbinom(n_mali, 1, 0.020)
ctr_novi2 <- rbinom(n_mali, 1, 0.035)

test2 <- t.test(ctr_novi2, ctr_stari2)

cat("=== Scenarij 2: Mali uzorak, veÄ‡a razlika ===\n")
cat("Razlika CTR:", round((mean(ctr_novi2) - mean(ctr_stari2)) * 100, 2), "postotnih bodova\n")
cat("P-vrijednost:", round(test2$p.value, 4), "\n")
cat("StatistiÄki znaÄajno:", test2$p.value < 0.05, "\n")
cat("ZasluÅ¾uje li daljnje istraÅ¾ivanje? Vjerojatno da.\n")
```

DonoÅ¡enje odluka na temelju samo p-vrijednosti je nepotpuno. Morate uzeti u obzir veliÄinu uÄinka, praktiÄne posljedice (troÅ¡ak redizajna vs dobitak od poveÄ‡anog CTR-a), interval pouzdanosti (koliki raspon razlika je konzistentan s podacima) i kontekst (kolika je razlika "dovoljno velika" u vaÅ¡oj industriji).

```{r}
#| label: prakticna-matrica
#| echo: true
#| message: false
#| warning: false

tribble(
  ~` `, ~`PraktiÄki vaÅ¾no`, ~`PraktiÄki nevaÅ¾no`,
  "StatistiÄki znaÄajno (p < 0.05)", "âœ… Djeluj! Razlika postoji i vaÅ¾na je.", "âš ï¸ Razlika postoji ali je premala da bi se isplatila.",
  "StatistiÄki neznaÄajno (p â‰¥ 0.05)", "ğŸ” MoÅ¾da nemaÅ¡ dovoljno podataka. PoveÄ‡aj uzorak.", "âœ… Nema uÄinka i to je u redu."
)
```

---

## Potpuna analiza: Instagram A/B test izvjeÅ¡taj {#sec-analiza}

Spojimo sve u koherentan izvjeÅ¡taj za urednicu. Slijedimo strukturu: opisna statistika, vizualizacija, statistiÄki test, veliÄina uÄinka, podanalize, zakljuÄak s preporukom.

```{r}
#| label: analiza-opisna
#| echo: true
#| message: false
#| warning: false

# Korak 1: Opisna statistika po formatu
ig |>
  group_by(format) |>
  summarise(
    n = n(),
    M_engagement = round(mean(engagement_rate) * 100, 2),
    SD_engagement = round(sd(engagement_rate) * 100, 2),
    M_likes = round(mean(likes), 0),
    M_comments = round(mean(comments), 0),
    M_shares = round(mean(shares), 0),
    M_saves = round(mean(saves), 0),
    .groups = "drop"
  )
```

```{r}
#| label: analiza-boxplot
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

ig |>
  ggplot(aes(x = format, y = engagement_rate * 100, fill = format)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(width = 0.15, alpha = 0.15, size = 1) +
  scale_fill_manual(values = c("carousel" = "#2a9d8f", "single_image" = "#e76f51")) +
  labs(
    title = "Engagement rate po formatu objave",
    subtitle = "Carousel objave imaju vidljivo viÅ¡i angaÅ¾man",
    x = NULL,
    y = "Engagement rate (%)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
#| label: analiza-test
#| echo: true
#| message: false
#| warning: false

# Korak 2: StatistiÄki test
test_ig <- t.test(carousel, single)

# Korak 3: VeliÄina uÄinka
s_pooled <- sqrt(((n1 - 1) * sd(carousel)^2 + (n2 - 1) * sd(single)^2) / (n1 + n2 - 2))
d_ig <- (mean(carousel) - mean(single)) / s_pooled

cat("=== REZULTAT DVOUZORAÄŒKOG T-TESTA ===\n")
cat("t(", round(test_ig$parameter, 1), ") = ", round(test_ig$statistic, 2), "\n", sep = "")
cat("p < 0.001\n")
cat("Razlika prosjeka: ", round((mean(carousel) - mean(single)) * 100, 2), " postotnih bodova\n", sep = "")
cat("95% CI za razliku: [", round(test_ig$conf.int[1] * 100, 2), ", ", 
    round(test_ig$conf.int[2] * 100, 2), "] postotnih bodova\n", sep = "")
cat("Cohenov d:", round(d_ig, 2), "(veliki uÄinak)\n")
```

```{r}
#| label: analiza-po-temi
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

# Korak 4: Je li prednost carousela konzistentna po temama?
ig |>
  group_by(topic, format) |>
  summarise(M = mean(engagement_rate) * 100, .groups = "drop") |>
  ggplot(aes(x = fct_reorder(topic, M, .fun = max), y = M, fill = format)) +
  geom_col(position = "dodge", alpha = 0.8) +
  scale_fill_manual(values = c("carousel" = "#2a9d8f", "single_image" = "#e76f51")) +
  labs(
    title = "Engagement rate po temi i formatu",
    subtitle = "Carousel prednost je konzistentna preko svih tema",
    x = NULL,
    y = "ProsjeÄni engagement rate (%)",
    fill = "Format"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
#| label: analiza-po-temi-testovi
#| echo: true
#| message: false
#| warning: false

# StatistiÄki testovi po temi
ig |>
  group_by(topic) |>
  summarise(
    n_carousel = sum(format == "carousel"),
    n_single = sum(format == "single_image"),
    M_carousel = round(mean(engagement_rate[format == "carousel"]) * 100, 2),
    M_single = round(mean(engagement_rate[format == "single_image"]) * 100, 2),
    razlika = round(M_carousel - M_single, 2),
    p = round(t.test(
      engagement_rate[format == "carousel"],
      engagement_rate[format == "single_image"]
    )$p.value, 4),
    znacajno = p < 0.05,
    .groups = "drop"
  )
```

Prednost carousela je statistiÄki znaÄajna za sve teme. UÄinak je konzistentan, Å¡to pojaÄava naÅ¡e povjerenje u zakljuÄak.

```{r}
#| label: analiza-cta
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

# Korak 5: Utjecaj CTA na komentare
ig |>
  group_by(format, has_cta) |>
  summarise(M_comments = mean(comments), .groups = "drop") |>
  mutate(has_cta = if_else(has_cta, "S pozivom na akciju", "Bez poziva na akciju")) |>
  ggplot(aes(x = format, y = M_comments, fill = has_cta)) +
  geom_col(position = "dodge", alpha = 0.8) +
  scale_fill_manual(values = c("S pozivom na akciju" = "#264653", "Bez poziva na akciju" = "#a8dadc")) +
  labs(
    title = "ProsjeÄan broj komentara: format Ã— poziv na akciju",
    subtitle = "CTA poveÄ‡ava komentare, osobito kod carousel objava",
    x = NULL,
    y = "ProsjeÄan broj komentara",
    fill = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
#| label: analiza-vrijeme
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

# Korak 6: Engagement po dobu dana
ig |>
  mutate(time_of_day = factor(time_of_day, levels = c("jutro", "podne", "poslijepodne", "veÄer"))) |>
  group_by(time_of_day, format) |>
  summarise(
    M = mean(engagement_rate) * 100,
    SE = sd(engagement_rate) / sqrt(n()) * 100,
    .groups = "drop"
  ) |>
  ggplot(aes(x = time_of_day, y = M, color = format, group = format)) +
  geom_line(linewidth = 1) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = M - 1.96 * SE, ymax = M + 1.96 * SE), width = 0.15) +
  scale_color_manual(values = c("carousel" = "#2a9d8f", "single_image" = "#e76f51")) +
  labs(
    title = "Engagement rate po dobu dana s intervalima pouzdanosti",
    subtitle = "Carousel prednost prisutna u svim terminima. Poslijepodne je optimalno za oba formata.",
    x = NULL,
    y = "Engagement rate (%)",
    color = "Format"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
#| label: analiza-zakljucak
#| echo: true
#| message: false
#| warning: false

# Korak 7: IzvjeÅ¡taj za urednicu
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
cat("   IZVJEÅ TAJ: A/B TEST FORMATA INSTAGRAM OBJAVA\n")
cat("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

cat("UZORAK: ", nrow(ig), " objava (", n1, " carousel, ", n2, " single image)\n\n", sep = "")

cat("GLAVNI NALAZ:\n")
cat("Carousel objave generiraju statistiÄki znaÄajno viÅ¡i angaÅ¾man\n")
cat("od single image objava.\n\n")

cat("BROJKE:\n")
cat("  Carousel engagement:    ", round(mean(carousel) * 100, 2), "% (SD = ", 
    round(sd(carousel) * 100, 2), "%)\n", sep = "")
cat("  Single image engagement:", round(mean(single) * 100, 2), "% (SD = ", 
    round(sd(single) * 100, 2), "%)\n", sep = "")
cat("  Razlika: ", round((mean(carousel) - mean(single)) * 100, 2), 
    " postotnih bodova\n", sep = "")
cat("  95% CI:  [", round(test_ig$conf.int[1] * 100, 2), ", ", 
    round(test_ig$conf.int[2] * 100, 2), "] postotnih bodova\n\n", sep = "")

cat("STATISTIKA:\n")
cat("  t(", round(test_ig$parameter, 1), ") = ", round(test_ig$statistic, 2), 
    ", p < 0.001\n", sep = "")
cat("  Cohenov d = ", round(d_ig, 2), " (veliki uÄinak)\n\n", sep = "")

cat("DODACI:\n")
cat("  * Prednost je konzistentna preko svih tema i svih doba dana.\n")
cat("  * Poziv na akciju dodatno pojaÄava komentare (+15%).\n")
cat("  * Poslijepodne je optimalno vrijeme za objavu oba formata.\n\n")

cat("PREPORUKA:\n")
cat("  Prebacite Å¡to veÄ‡i udio objava na carousel format,\n")
cat("  osobito za lifestyle i sportski sadrÅ¾aj koji i inaÄe\n")
cat("  generiraju najviÅ¡i angaÅ¾man. Kombinirajte s pozivom\n")
cat("  na akciju za maksimalne komentare.\n")
```

---

## JoÅ¡ o p-vrijednostima: ASA izjava i viÅ¡estruko testiranje {#sec-asa}

AmeriÄka statistiÄka asocijacija (ASA) je 2016. izdala izjavu o p-vrijednostima. Å est principa vrijedi ponoviti.

P-vrijednosti mogu pokazati koliko su podaci nekompatibilni sa specificiranim statistiÄkim modelom. P-vrijednosti ne mjere vjerojatnost da je hipoteza istinita niti vjerojatnost da su podaci proizvedeni samo sluÄajnoÅ¡Ä‡u. Znanstveni zakljuÄci i poslovne odluke ne bi se trebali temeljiti samo na tome prelazi li p-vrijednost specifiÄan prag. Ispravno zakljuÄivanje zahtijeva puno izvjeÅ¡tavanje i transparentnost. P-vrijednost ne mjeri veliÄinu uÄinka niti vaÅ¾nost rezultata. Sama p-vrijednost ne pruÅ¾a dobru mjeru dokaza za model ili hipotezu.

### ViÅ¡estruko testiranje

Kad provodimo mnogo testova istovremeno, poveÄ‡ava se Å¡ansa da barem jedan bude laÅ¾no pozitivan.

```{r}
#| label: visestruko-testiranje
#| echo: true
#| message: false
#| warning: false

# Simulacija: 20 testova, SVI pod Hâ‚€ (nema pravih razlika)
set.seed(42)

sim_20_testova <- map_df(1:20, \(i) {
  a <- rnorm(50, mean = 5, sd = 2)
  b <- rnorm(50, mean = 5, sd = 2)  # isti prosjek!
  test <- t.test(a, b)
  tibble(test_broj = i, p = round(test$p.value, 4), znacajno = test$p.value < 0.05)
})

cat("Od 20 testova (svi Hâ‚€ istiniti):\n")
cat("StatistiÄki znaÄajnih:", sum(sim_20_testova$znacajno), "\n\n")

sim_20_testova |> filter(znacajno)
```

ÄŒak i kad nijedan uÄinak ne postoji, jedan ili viÅ¡e testova moÅ¾e biti "statistiÄki znaÄajan." Ovo je problem viÅ¡estrukog testiranja. Postoje korekcije (Bonferronijeva: podijelite Î± s brojem testova), ali svjesnost o problemu je prvi korak.

```{r}
#| label: bonferroni
#| echo: true
#| message: false
#| warning: false

# Bonferronijeva korekcija
sim_20_testova |>
  mutate(
    p_korigirana = p.adjust(p, method = "bonferroni"),
    znacajno_korigirano = p_korigirana < 0.05
  ) |>
  filter(znacajno | znacajno_korigirano) |>
  select(test_broj, p, znacajno, p_korigirana, znacajno_korigirano)
```

Nakon Bonferronijeve korekcije, nijedan test nije znaÄajan. Korekcija je konzervativna (mnogo laÅ¾no negativnih), ali Å¡titi od laÅ¾no pozitivnih kad provodimo mnogo testova.

::: {.callout-warning}
## Upozorenje

Ako u istraÅ¾ivanju testirate mnogo varijabli i izvijestite samo one koje su znaÄajne, to se zove **p-hacking** ili **cherry-picking**. Rezultati dobiveni na taj naÄin nisu pouzdani jer ne uzimaju u obzir viÅ¡estruko testiranje. Uvijek izvijestite koliko ste testova proveli, ne samo one koji su dali p < 0.05.
:::

---

## Pregled svih t-testova {#sec-pregled}

```{r}
#| label: pregled-tablica
#| echo: true
#| message: false
#| warning: false

tribble(
  ~test, ~situacija, ~R_kod, ~primjer,
  "JednouzoraÄki", "Jedan uzorak vs poznata vrijednost", "t.test(x, mu = 5)", "Je li prosjeÄno vrijeme Äitanja = 3 min?",
  "DvouzoraÄki (nezavisni)", "Dvije nezavisne skupine", "t.test(x, y)", "Carousel vs single image engagement",
  "Upareni", "Iste jedinice, dva mjerenja", "t.test(x, y, paired = TRUE)", "Ocjene istih Älanaka od 2 urednika"
)
```

Sva tri testa imaju istu logiku (testiramo Hâ‚€, raÄunamo t, gledamo p). Razlikuju se u formulaciji Hâ‚€ i naÄinu izraÄuna SE. R funkcija `t.test()` pokriva sva tri sluÄaja.

---

::: {.callout-important}
## KljuÄni zakljuÄci

1. Testiranje hipoteza postavlja nultu hipotezu (Hâ‚€: nema uÄinka) i traÅ¾i dokaze protiv nje. Ako su podaci dovoljno neobiÄni pod Hâ‚€ (p < Î±), odbacujemo Hâ‚€.

2. Testna statistika mjeri koliko su podaci neobiÄni pod Hâ‚€. Za t-test: t = razlika / SE. VeÄ‡i |t| = jaÄi dokaz protiv Hâ‚€.

3. P-vrijednost je vjerojatnost podataka (ili ekstremnijih) pod Hâ‚€. NIJE vjerojatnost da je Hâ‚€ istinita. NIJE mjera veliÄine uÄinka.

4. `t.test()` pokriva jednouzoraÄki (mu = vrijednost), dvouzoraÄki (dva vektora) i upareni test (paired = TRUE). Welchov test (default) ne pretpostavlja jednake varijance.

5. GreÅ¡ka tipa I (Î±) je laÅ¾no pozitivni rezultat. GreÅ¡ka tipa II (Î²) je propuÅ¡tena prava razlika. Snaga = 1 âˆ’ Î² trebala bi biti barem 0.80.

6. Cohenov d izraÅ¾ava razliku u SD jedinicama: d = 0.2 mali, d = 0.5 srednji, d = 0.8 veliki uÄinak. Uvijek ga izvijestite uz p-vrijednost.

7. `power.t.test()` raÄuna potrebnu veliÄinu uzorka za zadanu snagu, uÄinak i Î±. Planirajte istraÅ¾ivanje PRIJE prikupljanja podataka.

8. Upareni t-test je osjetljiviji od nezavisnog jer kontrolira varijabilnost izmeÄ‘u parova. Koristite ga kad iste jedinice mjerite dva puta.

9. StatistiÄka znaÄajnost (p < 0.05) ne znaÄi praktiÄnu vaÅ¾nost. Velik uzorak moÅ¾e detektirati trivijalne razlike. Mali uzorak moÅ¾e propustiti vaÅ¾ne razlike.

10. ViÅ¡estruko testiranje inflacionira greÅ¡ku tipa I. Ako provodite mnogo testova, koristite korekciju (Bonferroni, BH) ili barem transparentno izvijestite koliko ste testova proveli.

11. Kompletni izvjeÅ¡taj ukljuÄuje opisnu statistiku, vizualizaciju, testnu statistiku s p-vrijednoÅ¡Ä‡u, veliÄinu uÄinka (d) s interpretacijom, interval pouzdanosti za razliku i praktiÄnu preporuku.

12. Odsutnost statistiÄki znaÄajnog rezultata (p â‰¥ 0.05) ne znaÄi da uÄinak ne postoji. MoÅ¾da uzorak nije bio dovoljno velik. Zato nikad ne kaÅ¾emo "prihvaÄ‡amo Hâ‚€."
:::

---

## Zadaci za pripremu

1. UÄitajte `instagram_ab_test.csv`. Testirajte razlikuje li se prosjeÄan broj `saves` izmeÄ‘u carousel i single image objava. IzraÄunajte Cohenov d i interpretirajte ga.

2. Odredite minimalnu veliÄinu uzorka po grupi potrebnu za detektiranje srednjeg uÄinka (d = 0.5) s 90% snagom na razini Î± = 0.01.

3. Simulirajte 1000 t-testova gdje su oba uzorka iz iste distribucije (Hâ‚€ istinita). Koliki postotak p-vrijednosti je ispod 0.05? Nacrtajte histogram p-vrijednosti i usporedite s uniformnom distribucijom.

---

## Dodatno Äitanje

**Obavezno**

Navarro, D. (2018). *Learning Statistics with R*, Chapter 11 (Hypothesis Testing). Besplatno dostupno na [learningstatisticswithr.com](https://learningstatisticswithr.com/lsr-0.6.pdf). Pokriva logiku testiranja hipoteza, t-test i p-vrijednost s R kodom.

**PreporuÄeno**

Diez, D., Ã‡etinkaya-Rundel, M., & Barr, C. (2019). *OpenIntro Statistics* (4th edition), Chapter 7. Besplatno dostupno na [openintro.org/book/os](https://www.openintro.org/book/os/). Jasne vizualizacije logike testiranja.

Wasserstein, R. L., & Lazar, N. A. (2016). The ASA Statement on p-Values: Context, Process, and Purpose. *The American Statistician*, 70(2), 129-133. SluÅ¾bena izjava o pravilnoj upotrebi i interpretaciji p-vrijednosti.

Cohen, J. (1992). A Power Primer. *Psychological Bulletin*, 112(1), 155-159. KlasiÄan kratki pregled veliÄina uÄinka i analize snage.

---

## Pojmovnik

| Pojam | ObjaÅ¡njenje |
|---|---|
| Nulta hipoteza (Hâ‚€) | PoÄetna pretpostavka da nema uÄinka ili razlike. SadrÅ¾i znak jednakosti. |
| Alternativna hipoteza (Hâ‚) | Tvrdnja da uÄinak ili razlika postoji. SadrÅ¾i znak nejednakosti. |
| Testna statistika | Broj koji mjeri koliko su podaci neobiÄni pod Hâ‚€. Za t-test: t = razlika / SE. |
| P-vrijednost | Vjerojatnost podataka (ili ekstremnijih) pod pretpostavkom da je Hâ‚€ istinita. |
| Razina znaÄajnosti (Î±) | Prag za odbacivanje Hâ‚€. ObiÄno 0.05. Kontrolira greÅ¡ku tipa I. |
| GreÅ¡ka tipa I | Odbacimo Hâ‚€ kad je istinita. LaÅ¾no pozitivni rezultat. Vjerojatnost = Î±. |
| GreÅ¡ka tipa II | Ne odbacimo Hâ‚€ kad je laÅ¾na. PropuÅ¡teni pravi uÄinak. Vjerojatnost = Î². |
| StatistiÄka snaga | Vjerojatnost detektiranja pravog uÄinka. Snaga = 1 âˆ’ Î². Cilj â‰¥ 0.80. |
| Cohenov d | Standardizirana mjera veliÄine uÄinka: razlika prosjeka / pooled SD. d = 0.2 mali, 0.5 srednji, 0.8 veliki. |
| Pooled SD | ZajedniÄka standardna devijacija dviju grupa, ponderirana njihovim veliÄinama. |
| JednouzoraÄki t-test | Usporedba jednog prosjeka s poznatom vrijednoÅ¡Ä‡u. `t.test(x, mu = ...)`. |
| DvouzoraÄki t-test | Usporedba prosjeka dviju nezavisnih skupina. `t.test(x, y)`. |
| Welchov t-test | Default u R-u. Ne pretpostavlja jednake varijance. Robusniji od Studentovog. |
| Upareni t-test | Usporedba parova (iste jedinice, dva mjerenja). `t.test(x, y, paired = TRUE)`. |
| Dvosmjerni test | Hâ‚: Î¼â‚ â‰  Î¼â‚‚. Testira razliku u oba smjera. Default u R-u. |
| Jednosmjerni test | Hâ‚: Î¼â‚ > Î¼â‚‚ ili Î¼â‚ < Î¼â‚‚. Osjetljiviji u jednom smjeru ali slijep za drugi. |
| ViÅ¡estruko testiranje | ProvoÄ‘enje mnogo testova istovremeno. Inflacionira greÅ¡ku tipa I. |
| Bonferronijeva korekcija | Dijeljenje Î± s brojem testova. Konzervativna ali jednostavna korekcija. |
| P-hacking | Selektivno izvjeÅ¡tavanje znaÄajnih rezultata iz mnogo provedenih testova. Neprihvatljiva praksa. |
| `power.t.test()` | R funkcija za analizu snage: izraÄun potrebnog n, snage ili detektabilnog uÄinka. |
| `p.adjust()` | R funkcija za korekciju p-vrijednosti za viÅ¡estruko testiranje (Bonferroni, BH, itd.). |
