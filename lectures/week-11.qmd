---
title: "Tjedan 11: Kategorički podaci i hi-kvadrat testovi"
subtitle: "Kada su varijable kategorije, ne brojevi"
date: 2025-05-03
categories: [hi-kvadrat, kategorički podaci, test nezavisnosti, goodness-of-fit, Fisherov test]
draft: false
---

```{r}
#| label: setup
#| echo: true
#| message: false
#| warning: false

library(tidyverse)
```

::: {.callout-note}
## Ishodi učenja

Nakon ovog predavanja moći ćete

1. Prepoznati situacije u kojima su hi-kvadrat testovi prikladni (kategoričke varijable).
2. Provesti i interpretirati hi-kvadrat test za dobrotu prilagodbe (goodness-of-fit).
3. Provesti i interpretirati hi-kvadrat test nezavisnosti za kontingencijsku tablicu.
4. Izračunati očekivane frekvencije i objasniti njihovo značenje.
5. Interpretirati standardizirane reziduale za otkrivanje specifičnih odstupanja.
6. Primijeniti Fisherov egzaktni test kad su očekivane frekvencije male.
7. Izračunati Cramérovo V kao mjeru veličine učinka za kategoričke podatke.
8. Kritički ocijeniti rezultate istraživanja koja koriste kategoričke varijable.
:::

## Motivacija: pitanja na koja t-test ne može odgovoriti

Prošla dva tjedna bavili smo se pitanjima poput "je li prosjek angažmana veći za carousel nego za single image." To su pitanja o prosjjecima numeričkih varijabli. Ali mnoga istraživačka pitanja u komunikologiji uključuju **kategoričke varijable** (varijable čije su vrijednosti kategorije, ne brojevi).

Postoji li veza između dobne skupine i preferiranog tipa medija? Preferiraju li mladi streaming a stariji TV ili je distribucija ista u svim dobnim skupinama? Odgovara li distribucija obrazovanja u našem uzorku populacijskim podacima? Ovisi li zadovoljstvo medijem o regiji?

Za ovakva pitanja trebamo **hi-kvadrat testove** (χ² testove). Oni testiraju postoji li statistički značajna veza između dviju kategoričkih varijabli ili odstupa li opažena distribucija od očekivane.

---

## Naši podaci {#sec-podaci}

Koristimo podatke ankete o medijskim navikama provedene na 800 ispitanika iz različitih dobnih skupina i regija.

```{r}
#| label: ucitavanje
#| echo: true
#| message: false
#| warning: false

survey <- read_csv("../resources/datasets/media_survey_chi2.csv")
glimpse(survey)
```

```{r}
#| label: pregled
#| echo: true
#| message: false
#| warning: false

# Distribucija ključnih varijabli
survey |> count(age_group, sort = TRUE)
survey |> count(media_type, sort = TRUE)
```

Ključne kategoričke varijable su `age_group` (4 kategorije) i `media_type` (6 kategorija). Temeljno pitanje je: postoji li veza između dobi i preferiranog medija?

---

## Kontingencijska tablica {#sec-kontingencijska}

Prvo što napravimo s dvjema kategoričkim varijablama je **kontingencijska tablica** (contingency table, cross-tabulation). Ona prikazuje frekvencije za svaku kombinaciju kategorija.

```{r}
#| label: kontingencijska-tablica
#| echo: true
#| message: false
#| warning: false

# Kontingencijska tablica: dob × tip medija
kont_tablica <- table(survey$age_group, survey$media_type)
kont_tablica
```

```{r}
#| label: kont-proporcije
#| echo: true
#| message: false
#| warning: false

# Proporcije po retku (svaka dobna skupina = 100%)
round(prop.table(kont_tablica, margin = 1) * 100, 1)
```

Proporcije po retku govore jasnu priču. Među osobama 18-29, 43% preferira streaming i 27% web portale. Među osobama 60+, 47% preferira TV i 23% radio. Obrazac je očit: mlađi preferiraju digitalne medije, stariji tradicionalne.

Ali je li ovaj obrazac statistički značajan ili bi mogao nastati slučajno?

```{r}
#| label: kont-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

survey |>
  count(age_group, media_type) |>
  group_by(age_group) |>
  mutate(udio = n / sum(n)) |>
  ungroup() |>
  mutate(media_type = fct_reorder(media_type, udio, .fun = sum)) |>
  ggplot(aes(x = age_group, y = udio, fill = media_type)) +
  geom_col(position = "fill", alpha = 0.85) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Preferirani tip medija po dobnim skupinama",
    subtitle = "Jasna promjena od digitalnih (mladi) prema tradicionalnim medijima (stariji)",
    x = "Dobna skupina",
    y = "Udio unutar dobne skupine",
    fill = "Tip medija"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

---

## Hi-kvadrat test za dobrotu prilagodbe (goodness-of-fit) {#sec-gof}

Prije nego prijeđemo na vezu dviju varijabli, krenimo s jednostavnijim pitanjem: odgovara li distribucija jedne kategoričke varijable nekoj očekivanoj distribuciji?

Situacija: medijska kuća tvrdi da ima podjednaku publiku iz svih pet regija. Naša anketa pokazuje drugačiju sliku. Želimo testirati odstupa li opažena distribucija od uniformne.

$$H_0: \text{Distribucija regija u uzorku odgovara uniformnoj distribuciji (20\% svaka)}$$
$$H_1: \text{Distribucija regija nije uniformna}$$

```{r}
#| label: gof-opazene
#| echo: true
#| message: false
#| warning: false

# Opažene frekvencije
opazene <- survey |> count(region) |> arrange(desc(n))
opazene
```

```{r}
#| label: gof-test
#| echo: true
#| message: false
#| warning: false

# Hi-kvadrat test za dobrotu prilagodbe
# H₀: sve regije imaju jednaki udio (20% svaka)
gof_test <- chisq.test(opazene$n)
gof_test
```

### Kako funkcionira hi-kvadrat statistika?

Hi-kvadrat statistika mjeri ukupno odstupanje opaženih frekvencija od očekivanih:

$$\chi^2 = \sum \frac{(O_i - E_i)^2}{E_i}$$

gdje je $O_i$ opažena frekvencija, a $E_i$ očekivana frekvencija za kategoriju $i$. Što je veća razlika između opaženih i očekivanih, veća je χ².

```{r}
#| label: gof-rucno
#| echo: true
#| message: false
#| warning: false

n_total <- nrow(survey)
n_kategorija <- 5

# Pod H₀ (uniformna distribucija), svaka regija ima n/5 ispitanika
ocekivane <- rep(n_total / n_kategorija, n_kategorija)

tibble(
  regija = opazene$region,
  O = opazene$n,
  E = ocekivane,
  razlika = O - E,
  doprinos_chi2 = round((O - E)^2 / E, 2)
) |>
  bind_rows(tibble(
    regija = "UKUPNO",
    O = sum(opazene$n),
    E = sum(ocekivane),
    razlika = 0,
    doprinos_chi2 = round(sum((opazene$n - ocekivane)^2 / ocekivane), 2)
  ))
```

Svaka kategorija doprinosi ukupnom χ² ovisno o tome koliko njezina opažena frekvencija odstupa od očekivane. Zadnji redak (UKUPNO) je testna statistika χ².

```{r}
#| label: gof-distribucija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

# Vizualizacija: hi-kvadrat distribucija
df_gof <- n_kategorija - 1  # stupnjevi slobode = broj kategorija - 1

x_vals <- seq(0, 20, length.out = 300)

chi_data <- tibble(x = x_vals, density = dchisq(x_vals, df = df_gof))

ggplot(chi_data, aes(x = x, y = density)) +
  geom_line(linewidth = 1) +
  geom_area(data = chi_data |> filter(x >= gof_test$statistic), fill = "firebrick", alpha = 0.4) +
  geom_vline(xintercept = gof_test$statistic, color = "firebrick", linetype = "dashed") +
  annotate("text", x = gof_test$statistic + 0.5, y = 0.05,
           label = paste0("χ² = ", round(gof_test$statistic, 2)), 
           color = "firebrick", hjust = 0) +
  labs(
    title = "Hi-kvadrat distribucija (df = 4)",
    subtitle = paste0("P-vrijednost = crveno područje = ", round(gof_test$p.value, 4)),
    x = "χ² vrijednost",
    y = "Gustoća"
  ) +
  theme_minimal()
```

P-vrijednost je manja od 0.05, što znači da distribucija regija u uzorku statistički značajno odstupa od uniformne. Zagreb je nadreprezentiran, a ostale regije su podreprezentirane.

### Testiranje s poznatim proporcijama

Češći slučaj je testiranje protiv poznatih populacijskih proporcija, ne uniformne distribucije.

```{r}
#| label: gof-poznate-proporcije
#| echo: true
#| message: false
#| warning: false

# Populacijski udjeli regija (fiktivni, ali bazirani na stvarnim omjerima)
pop_udjeli <- c(
  "Dalmacija" = 0.20, 
  "Primorje" = 0.14, 
  "Sjeverozapad" = 0.18, 
  "Slavonija" = 0.18, 
  "Zagreb" = 0.30
)

# Opaženi poredak mora odgovarati poretku proporcija
opazene_sortirane <- survey |> 
  count(region) |> 
  arrange(region)

gof_pop <- chisq.test(opazene_sortirane$n, p = pop_udjeli)
gof_pop
```

Kad testiramo protiv stvarnih populacijskih proporcija (gdje Zagreb čini 30% populacije), rezultat je drugačiji. P-vrijednost je veća, što znači da naš uzorak zapravo dobro odražava populacijsku distribuciju regija. Ovo je važna razlika: isti podaci mogu biti "odstupajući" od jedne distribucije a "konzistentni" s drugom.

---

## Hi-kvadrat test nezavisnosti {#sec-nezavisnost}

Sada prelazimo na glavno pitanje: postoji li **veza** (asocijacija) između dviju kategoričkih varijabli? Konkretno: ovisi li preferirani tip medija o dobnoj skupini?

$$H_0: \text{Tip medija i dobna skupina su nezavisni (nema veze)}$$
$$H_1: \text{Tip medija i dobna skupina NISU nezavisni (postoji veza)}$$

"Nezavisni" znači da poznavanje nečije dobne skupine ne pomaže u predviđanju njihovog preferiranog medija. Ako su nezavisni, distribucija medijskog tipa trebala bi biti ista u svim dobnim skupinama.

```{r}
#| label: nezavisnost-test
#| echo: true
#| message: false
#| warning: false

chi2_test <- chisq.test(kont_tablica)
chi2_test
```

P-vrijednost je iznimno mala (p < 2.2e-16). Imamo izuzetno snažne dokaze da postoji veza između dobi i preferiranog tipa medija. Ali χ² statistika sama ne govori koji parovi kategorija su odgovorni za vezu.

### Očekivane frekvencije

Očekivane frekvencije su ono što bismo očekivali da vidimo KAD NE BI BILO veze između varijabli. Računaju se kao:

$$E_{ij} = \frac{\text{ukupno u retku i} \times \text{ukupno u stupcu j}}{\text{ukupno}}$$

```{r}
#| label: ocekivane
#| echo: true
#| message: false
#| warning: false

# Očekivane frekvencije
round(chi2_test$expected, 1)
```

```{r}
#| label: opazene-vs-ocekivane
#| echo: true
#| message: false
#| warning: false

# Usporedba: opažene vs očekivane
cat("OPAŽENE frekvencije:\n")
kont_tablica
cat("\nOČEKIVANE frekvencije (pod H₀: nema veze):\n")
round(chi2_test$expected, 1)
```

Pod H₀ (nema veze), sve dobne skupine bi imale istu distribuciju medijskih tipova. Na primjer, ako 22% cijelog uzorka preferira streaming, onda bi i u skupini 18-29 i u skupini 60+ oko 22% preferiralo streaming. Ali u stvarnosti, 43% mladih preferira streaming, a samo 4% starijih. Ovo veliko odstupanje od očekivanih je ono što test detektira.

### Provjera pretpostavki

Hi-kvadrat test ima važnu pretpostavku: sve očekivane frekvencije trebaju biti dovoljno velike (konvencija: barem 5).

```{r}
#| label: provjera-pretpostavki
#| echo: true
#| message: false
#| warning: false

# Provjera: ima li očekivanih frekvencija < 5?
min_expected <- min(chi2_test$expected)
cat("Najmanja očekivana frekvencija:", round(min_expected, 1), "\n")
cat("Sve ≥ 5:", min_expected >= 5, "\n")
```

Sve očekivane frekvencije su iznad 5, što znači da je hi-kvadrat test valjan. Kad ovo nije slučaj (male frekvencije), trebamo koristiti Fisherov egzaktni test.

---

## Standardizirani reziduali: gdje je veza najjača? {#sec-reziduali}

Ukupna χ² statistika govori da veza postoji, ali ne govori gdje. Za to koristimo **standardizirane reziduale** (Pearsonove reziduale):

$$r_{ij} = \frac{O_{ij} - E_{ij}}{\sqrt{E_{ij}}}$$

Rezidual veći od +2 znači da ta ćelija ima značajno VIŠE opažanja nego što očekujemo pod H₀. Rezidual manji od -2 znači značajno MANJE.

```{r}
#| label: reziduali
#| echo: true
#| message: false
#| warning: false

round(chi2_test$residuals, 2)
```

```{r}
#| label: reziduali-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 6

# Vizualizacija standardiziranih reziduala
as.data.frame(chi2_test$residuals) |>
  as_tibble() |>
  rename(age_group = Var1, media_type = Var2, residual = Freq) |>
  ggplot(aes(x = media_type, y = age_group, fill = residual)) +
  geom_tile(color = "white", linewidth = 1) +
  geom_text(aes(label = round(residual, 1)), size = 4, fontface = "bold") +
  scale_fill_gradient2(low = "#e76f51", mid = "white", high = "#2a9d8f", midpoint = 0) +
  labs(
    title = "Standardizirani reziduali: dob × tip medija",
    subtitle = "Zeleno = više nego očekivano. Crveno = manje nego očekivano. Značajno ako |r| > 2.",
    x = "Tip medija",
    y = "Dobna skupina",
    fill = "Rezidual"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```

Ovaj graf je zlatni rudnik informacija. Najjače zelene ćelije (puno više nego očekivano) su streaming u skupini 18-29 (+6.2) i TV u skupini 60+ (+6.6). Najjače crvene ćelije (puno manje nego očekivano) su TV u skupini 18-29 (-4.3) i streaming u skupini 60+ (-5.1). Reziduali jasno potvrđuju generacijski jaz u medijskim navikama.

::: {.callout-tip}
## Praktični savjet

Kad izvještavate rezultate hi-kvadrat testa, ne stajte samo na "χ² je značajan." Koristite reziduale da identificirate specifične kombinacije kategorija koje najviše doprinose vezi. Urednica ne želi znati samo da "postoji veza između dobi i medija." Želi znati KOJA je ta veza: mladi biraju streaming, stariji TV.
:::

---

## Mjera veličine učinka: Cramérovo V {#sec-cramer}

Kao i kod t-testa, sama statistička značajnost ne govori koliko je veza jaka. **Cramérovo V** je mjera veličine učinka za hi-kvadrat test nezavisnosti:

$$V = \sqrt{\frac{\chi^2}{n \times (k - 1)}}$$

gdje je $n$ ukupan broj opažanja, a $k$ manji od broja redova ili stupaca kontingencijske tablice. V varira od 0 (potpuna nezavisnost) do 1 (savršena asocijacija).

```{r}
#| label: cramer-v
#| echo: true
#| message: false
#| warning: false

chi2_val <- chi2_test$statistic
n_obs <- sum(kont_tablica)
k <- min(nrow(kont_tablica), ncol(kont_tablica))

cramer_v <- sqrt(chi2_val / (n_obs * (k - 1)))

cat("χ² =", round(chi2_val, 2), "\n")
cat("n =", n_obs, "\n")
cat("k =", k, "(minimum redova/stupaca)\n")
cat("Cramérovo V =", round(cramer_v, 3), "\n")
```

### Interpretacija Cramérovog V

Cohen (1988) je predložio smjernice ovisne o stupnjevima slobode. Za tablicu s k = 4 (naš slučaj):

```{r}
#| label: cramer-smjernice
#| echo: true
#| message: false
#| warning: false

tribble(
  ~V, ~interpretacija,
  "0.06", "Mali učinak",
  "0.17", "Srednji učinak",
  "0.29", "Veliki učinak"
)
```

Naše V ≈ `r round(cramer_v, 2)` je veliki učinak. Veza između dobi i medijskog tipa je ne samo statistički značajna nego i praktično snažna.

---

## Vizualizacija kategoričkih podataka {#sec-vizualizacija}

Kontingencijske tablice su korisne ali teške za brzo čitanje. Vizualizacije pomažu.

```{r}
#| label: mozaik-ggplot
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 6

# Grupani stupčasti graf (najprikladniji za prezentaciju)
survey |>
  count(age_group, media_type) |>
  group_by(age_group) |>
  mutate(udio = n / sum(n)) |>
  ungroup() |>
  ggplot(aes(x = age_group, y = udio, fill = media_type)) +
  geom_col(position = "dodge", alpha = 0.85) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Preferirani tip medija po dobnim skupinama",
    subtitle = paste0("χ² = ", round(chi2_val, 1), ", p < 0.001, Cramérovo V = ", 
                      round(cramer_v, 2), " (veliki učinak)"),
    x = "Dobna skupina",
    y = "Udio",
    fill = "Tip medija"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
#| label: balon-graf
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 6

# Balon graf (dobra alternativa za kontingencijske tablice)
survey |>
  count(age_group, media_type) |>
  group_by(age_group) |>
  mutate(udio = n / sum(n)) |>
  ungroup() |>
  ggplot(aes(x = media_type, y = age_group, size = udio, color = udio)) +
  geom_point() +
  scale_size_continuous(range = c(2, 15), labels = scales::label_percent()) +
  scale_color_viridis_c(option = "D", labels = scales::label_percent()) +
  labs(
    title = "Balon graf: dob × tip medija",
    subtitle = "Veći i svjetliji balon = veći udio u toj dobnoj skupini",
    x = "Tip medija",
    y = "Dobna skupina",
    size = "Udio", color = "Udio"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```

---

## Hi-kvadrat test u praksi: korak po korak {#sec-koraci}

Sažmimo postupak u jasne korake koje možete primijeniti na bilo koji par kategoričkih varijabli.

**Korak 1**: Formulirajte hipoteze.

**Korak 2**: Napravite kontingencijsku tablicu i vizualizirajte podatke.

**Korak 3**: Provjerite pretpostavke (sve očekivane frekvencije ≥ 5).

**Korak 4**: Provedite test i izračunajte p-vrijednost.

**Korak 5**: Izračunajte veličinu učinka (Cramérovo V).

**Korak 6**: Pogledajte reziduale za specifična odstupanja.

**Korak 7**: Interpretirajte u kontekstu.

```{r}
#| label: primjer-spol-sadrzaj
#| echo: true
#| message: false
#| warning: false

# Primjer: postoji li veza između spola i preferencije sadržaja?
tablica_spol <- table(survey$gender, survey$content_preference)

# Korak 2: kontingencijska tablica
tablica_spol

# Korak 3: provjera
chi_spol <- chisq.test(tablica_spol)
cat("\nNajmanja očekivana frekvencija:", round(min(chi_spol$expected), 1), "\n")

# Korak 4: test
chi_spol

# Korak 5: Cramérovo V
v_spol <- sqrt(chi_spol$statistic / (sum(tablica_spol) * (min(dim(tablica_spol)) - 1)))
cat("Cramérovo V:", round(v_spol, 3), "\n")

# Korak 6: reziduali
cat("\nStandardizirani reziduali:\n")
round(chi_spol$residuals, 2)
```

U ovom primjeru, odnos između spola i preferencije sadržaja možda nije statistički značajan (ovisi o p-vrijednosti). Ovo je potpuno normalan rezultat: ne mora svaka veza biti značajna. Podatke treba pustiti da govore.

---


::: {.callout-note}
## Podsjetnik

U prvom dijelu naučili smo hi-kvadrat test za dobrotu prilagodbe i test nezavisnosti, očekivane frekvencije, standardizirane reziduale i Cramérovo V. U ovom dijelu pokrivamo situacije kad standardni hi-kvadrat test nije primjeren te provodimo potpunu analizu kategoričkih podataka.
:::

## Fisherov egzaktni test {#sec-fisher}

Hi-kvadrat test je aproksimacija koja radi dobro kad su očekivane frekvencije dovoljno velike (sve ≥ 5). Kad to nije slučaj (mali uzorak, rijetke kategorije), aproksimacija postaje nepouzdana. **Fisherov egzaktni test** računa točnu p-vrijednost bez aproksimacije.

Situacija: testirate vezu između tipa CTA (call-to-action) i konverzije na malom uzorku od 40 newsletter kampanja.

```{r}
#| label: fisher-primjer
#| echo: true
#| message: false
#| warning: false

# Mali uzorak: 40 kampanja, 2 x 2 tablica
set.seed(42)

kampanje <- tibble(
  cta_tip = c(rep("direktni", 20), rep("indirektni", 20)),
  konverzija = c(
    sample(c("da", "ne"), 20, replace = TRUE, prob = c(0.45, 0.55)),
    sample(c("da", "ne"), 20, replace = TRUE, prob = c(0.20, 0.80))
  )
)

tablica_cta <- table(kampanje$cta_tip, kampanje$konverzija)
tablica_cta
```

```{r}
#| label: fisher-ocekivane
#| echo: true
#| message: false
#| warning: false

# Provjera ocekivanih frekvencija
chi_cta <- chisq.test(tablica_cta, correct = FALSE)
chi_cta$expected
```

Neke očekivane frekvencije su blizu 5 (ili ispod). Hi-kvadrat aproksimacija nije pouzdana. Koristimo Fisherov test.

```{r}
#| label: fisher-test
#| echo: true
#| message: false
#| warning: false

# Fisherov egzaktni test
fisher.test(tablica_cta)
```

```{r}
#| label: fisher-usporedba
#| echo: true
#| message: false
#| warning: false

# Usporedba tri pristupa
cat("Hi-kvadrat (bez korekcije):  p =", round(chi_cta$p.value, 4), "\n")
cat("Hi-kvadrat (Yates korekcija): p =", round(chisq.test(tablica_cta)$p.value, 4), "\n")
cat("Fisherov egzaktni test:       p =", round(fisher.test(tablica_cta)$p.value, 4), "\n")
```

Fisherov test daje nešto drugačiju p-vrijednost od hi-kvadrata. Za male uzorke, Fisherov test je pouzdaniji. R po defaultu primjenjuje **Yatesovu korekciju kontinuiteta** na 2x2 tablice (`chisq.test` s `correct = TRUE`), što daje konzervativniju p-vrijednost, ali Fisherov test je ipak bolji izbor kad su očekivane frekvencije male.

### Odds ratio iz Fisherovog testa

Fisherov test za 2x2 tablice automatski računa **odds ratio** (omjer šansi), što je korisna mjera veličine učinka za binarne ishode.

```{r}
#| label: odds-ratio
#| echo: true
#| message: false
#| warning: false

fisher_rez <- fisher.test(tablica_cta)

cat("Odds ratio:", round(fisher_rez$estimate, 2), "\n")
cat("95% CI: [", round(fisher_rez$conf.int[1], 2), ",", round(fisher_rez$conf.int[2], 2), "]\n")
```

Odds ratio > 1 znači da je šansa konverzije veća uz direktni CTA. Odds ratio = 1 bi značio da nema razlike. CI koji ne sadrži 1 sugerira statistički značajnu razliku.

::: {.callout-tip}
## Kada koristiti koji test?

**Hi-kvadrat test**: Kad su sve očekivane frekvencije >= 5 i tablica je veća od 2x2. Brz i dovoljno točan za velike uzorke.

**Fisherov egzaktni test**: Kad su neke očekivane frekvencije < 5 ili je ukupni uzorak mali (< 50). Funkcionira za bilo koju veličinu tablice, ali je računalno zahtjevniji za veće tablice.

U praksi, Fisherov test možete koristiti uvijek. Za velike uzorke daje identične rezultate kao hi-kvadrat. Razlika se pojavljuje samo za male uzorke, gdje je Fisherov test bolji.
:::

---

## Spajanje kategorija {#sec-spajanje}

Ponekad kontingencijska tablica ima kategorije s vrlo malo opažanja. Umjesto da odmah pribjegnemo Fisherovom testu, možemo spojiti (kolapsirati) slične kategorije.

```{r}
#| label: spajanje-kategorija
#| echo: true
#| message: false
#| warning: false

survey <- read_csv("../resources/datasets/media_survey_chi2.csv")

# Originalna tablica: media_type ima 6 kategorija, neke male
table(survey$media_type)

# Spajanje: digitalni (streaming + web_portal + podcast) vs tradicionalni (TV + radio + tisak)
survey <- survey |>
  mutate(media_grupa = if_else(
    media_type %in% c("streaming", "web_portal", "podcast"),
    "digitalni",
    "tradicionalni"
  ))

# Nova tablica: 4 x 2 (preglednija i s vecim frekvencijama)
table(survey$age_group, survey$media_grupa)
```

```{r}
#| label: spajanje-test
#| echo: true
#| message: false
#| warning: false

chi_grupa <- chisq.test(table(survey$age_group, survey$media_grupa))
chi_grupa

# Cramerovo V za 4 x 2 tablicu
v_grupa <- sqrt(chi_grupa$statistic / (nrow(survey) * (min(4, 2) - 1)))
cat("\nCramerovo V:", round(v_grupa, 3), "\n")
```

Sažeta tablica je jasnija za komunikaciju rezultata. Umjesto šest kategorija, imamo jednu binarnu podjelu: digitalni vs tradicionalni mediji. Veza s dobi je i dalje izuzetno značajna i velika.

```{r}
#| label: spajanje-vizualizacija
#| echo: true
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 5

survey |>
  count(age_group, media_grupa) |>
  group_by(age_group) |>
  mutate(udio = n / sum(n)) |>
  ungroup() |>
  ggplot(aes(x = age_group, y = udio, fill = media_grupa)) +
  geom_col(alpha = 0.85) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_fill_manual(values = c("digitalni" = "#2a9d8f", "tradicionalni" = "#e76f51")) +
  geom_text(aes(label = paste0(round(udio * 100), "%")), 
            position = position_stack(vjust = 0.5), color = "white", fontface = "bold") +
  labs(
    title = "Digitalni vs tradicionalni mediji po dobnim skupinama",
    subtitle = paste0("chi2 = ", round(chi_grupa$statistic, 1), ", p < 0.001, V = ", 
                      round(v_grupa, 2)),
    x = "Dobna skupina",
    y = "Udio",
    fill = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Priča je sada kristalno jasna: 85% osoba 18-29 preferira digitalne medije, ali samo 26% osoba 60+. Generacijski jaz je masivan.

---

## Stratificirana analiza {#sec-stratifikacija}

Ponekad nas zanima je li veza između dviju varijabli konzistentna unutar podgrupa treće varijable. Na primjer: postoji li veza između medijskog tipa i zadovoljstva, ali odvojeno za svaku dobnu skupinu?

```{r}
#| label: stratifikacija
#| echo: true
#| message: false
#| warning: false

# Zadovoljstvo kategorizirano: nisko (1-2), srednje (3), visoko (4-5)
survey <- survey |>
  mutate(satisfaction_cat = case_when(
    satisfaction <= 2 ~ "nisko",
    satisfaction == 3 ~ "srednje",
    satisfaction >= 4 ~ "visoko"
  ))

# Hi-kvadrat test po dobnim skupinama
survey |>
  group_by(age_group) |>
  summarise(
    n = n(),
    chi2 = chisq.test(table(media_grupa, satisfaction_cat))$statistic,
    p = chisq.test(table(media_grupa, satisfaction_cat))$p.value,
    V = {
      tab <- table(media_grupa, satisfaction_cat)
      sqrt(chisq.test(tab)$statistic / (n() * (min(dim(tab)) - 1)))
    },
    .groups = "drop"
  ) |>
  mutate(
    chi2 = round(chi2, 2),
    p = round(p, 4),
    V = round(V, 3),
    znacajno = p < 0.05
  )
```

Stratificirana analiza može otkriti da veza koja postoji ukupno ne postoji u svim podgrupama (ili obrnuto). Ovo je povezano s Simpsonovim paradoksom: agregirani rezultati mogu biti obmanjujući.

---

## Simpsonov paradoks {#sec-simpson}

**Simpsonov paradoks** nastaje kad se smjer veze promijeni kad kontroliramo treću varijablu. Ovo je jedan od najvažnijih koncepata za razumijevanje kategoričkih podataka u komunikologiji.

```{r}
#| label: simpson-demo
#| echo: true
#| message: false
#| warning: false

# Konstruirani primjer: dva portala, CTR po tipu uredaja
simpson <- tribble(
  ~portal, ~uredaj, ~klikovi, ~prikazi,
  "Portal A", "mobitel",  80, 1000,
  "Portal A", "desktop", 180,  500,
  "Portal B", "mobitel",  30,  500,
  "Portal B", "desktop",  80,  200
) |>
  mutate(ctr = round(klikovi / prikazi * 100, 1))

# Ukupni CTR
simpson |>
  group_by(portal) |>
  summarise(
    ukupno_klikovi = sum(klikovi),
    ukupno_prikazi = sum(prikazi),
    ukupni_ctr = round(ukupno_klikovi / ukupno_prikazi * 100, 1),
    .groups = "drop"
  )
```

```{r}
#| label: simpson-po-uredaju
#| echo: true
#| message: false
#| warning: false

# CTR po uredaju
simpson |>
  select(portal, uredaj, ctr, prikazi)
```

Portal B ima viši CTR na SVAKOM uređaju (mobitel: 6.0% vs 8.0%, desktop: 36.0% vs 40.0%). Ali Portal A može imati viši ukupni CTR! Razlog je u tome što Portal A ima mnogo više mobilnog prometa (1000 od 1500 prikaza) koji ima nizak CTR, dok Portal B ima relativno više desktop prometa s visokim CTR-om. Kad agregiramo, neravnomjerna raspodjela uređaja "prevagne" i stvori obmanjujuće ukupne brojke.

::: {.callout-warning}
## Upozorenje

Simpsonov paradoks nije rijedak kuriozitet. U komunikološkim istraživanjima je čest jer se grupe (dobne, regionalne, platformske) razlikuju po veličini i karakteristikama. Kad god uspoređujete kategoričke podatke agregirano, zapitajte se: bi li se zaključak promijenio kad biste razdvojili po nekoj trećoj varijabli?
:::

---

## McNemarov test za uparene proporcije {#sec-mcnemar}

Kad imate uparene kategoričke podatke (isti ispitanici mjereni dva puta), standardni hi-kvadrat test nije primjeren. Za tu situaciju koristimo **McNemarov test**.

Situacija: 200 ispitanika je pitano preferiraju li online ili tiskane vijesti, jednom na početku i jednom na kraju semestra.

```{r}
#| label: mcnemar-podaci
#| echo: true
#| message: false
#| warning: false

set.seed(42)

# Simulacija: pomak prema onlineu kroz semestar
n_mc <- 200
prije <- sample(c("online", "tisak"), n_mc, replace = TRUE, prob = c(0.55, 0.45))

# Poslije: neki presli na online, malo ih preslo na tisak
poslije <- prije
promijenili <- sample(1:n_mc, 40)
for (i in promijenili[1:30]) poslije[i] <- "online"
for (i in promijenili[31:40]) poslije[i] <- "tisak"

mc_tablica <- table(Prije = prije, Poslije = poslije)
mc_tablica
```

Ova tablica se čita ovako: na dijagonali su ispitanici koji NISU promijenili mišljenje. Izvan dijagonale su oni koji jesu. McNemarov test testira je li broj promjena u jednom smjeru (tisak na online) značajno veći od broja promjena u drugom (online na tisak).

```{r}
#| label: mcnemar-test
#| echo: true
#| message: false
#| warning: false

mcnemar.test(mc_tablica)
```

```{r}
#| label: mcnemar-detalji
#| echo: true
#| message: false
#| warning: false

# Koliko je preslo u kojem smjeru?
tisak_na_online <- mc_tablica["tisak", "online"]
online_na_tisak <- mc_tablica["online", "tisak"]

cat("Presli tisak na online:", tisak_na_online, "\n")
cat("Presli online na tisak:", online_na_tisak, "\n")
cat("Neto pomak prema onlineu:", tisak_na_online - online_na_tisak, "\n")
```

McNemarov test pokazuje je li pomak prema online vijestima statistički značajan. Više ispitanika je prešlo s tiska na online nego obrnuto.

::: {.callout-important}
## Kada koristiti McNemarov test?

Kad imate **iste ispitanike** mjerene dva puta na istoj binarnoj varijabli. Primjeri: preferencija prije i poslije kampanje, stav prije i poslije vijesti, izbor prije i poslije redizajna. McNemarov test je za kategoričke podatke ono što je upareni t-test za numeričke.
:::

---

## Potpuna analiza: medijske navike i demografija {#sec-analiza}

Provedimo kompletnu analizu kategoričkih podataka na našem datasetu. Istražujemo tri pitanja: (1) Ovisi li tip medija o dobi? (2) Ovisi li o regiji? (3) Ovisi li preferencija sadržaja o obrazovanju?

```{r}
#| label: analiza-q1
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 5

# Pitanje 1: Dob x tip medija (detaljno, svih 6 tipova)
tab1 <- table(survey$age_group, survey$media_type)
test_q1 <- chisq.test(tab1)
v1 <- sqrt(test_q1$statistic / (sum(tab1) * (min(dim(tab1)) - 1)))

cat("=== PITANJE 1: Dob x Tip medija ===\n")
cat("chi2(", (nrow(tab1)-1)*(ncol(tab1)-1), ") = ", round(test_q1$statistic, 1),
    ", p < 0.001, V = ", round(v1, 2), "\n", sep = "")
cat("Interpretacija: Jaka veza. Mladi preferiraju streaming i portale,\n")
cat("stariji TV i radio.\n\n")

# Koji reziduali su najjaci?
rez_df <- as.data.frame(test_q1$residuals) |>
  as_tibble() |>
  rename(age = Var1, media = Var2, r = Freq) |>
  filter(abs(r) > 2) |>
  arrange(desc(abs(r)))

cat("Celije s |rezidual| > 2:\n")
rez_df |>
  mutate(r = round(r, 1), smjer = if_else(r > 0, "VISE nego ocekivano", "MANJE nego ocekivano")) |>
  print(n = 20)
```

```{r}
#| label: analiza-q2
#| echo: true
#| message: false
#| warning: false

# Pitanje 2: Regija x tip medija (digitalni vs tradicionalni)
tab2 <- table(survey$region, survey$media_grupa)
test_q2 <- chisq.test(tab2)
v2 <- sqrt(test_q2$statistic / (sum(tab2) * (min(dim(tab2)) - 1)))

cat("=== PITANJE 2: Regija x Digitalni/Tradicionalni ===\n")
cat("chi2(", (nrow(tab2)-1)*(ncol(tab2)-1), ") = ", round(test_q2$statistic, 2),
    ", p = ", round(test_q2$p.value, 4), ", V = ", round(v2, 3), "\n", sep = "")
cat("Interpretacija:", if_else(test_q2$p.value < 0.05,
    "Postoji znacajna razlika medju regijama.",
    "Nema znacajne razlike medju regijama."), "\n\n")

# Proporcije digitalnih po regiji
survey |>
  group_by(region) |>
  summarise(
    n = n(),
    udio_digitalni = round(mean(media_grupa == "digitalni") * 100, 1),
    .groups = "drop"
  ) |>
  arrange(desc(udio_digitalni))
```

```{r}
#| label: analiza-q3
#| echo: true
#| message: false
#| warning: false
#| fig-width: 9
#| fig-height: 6

# Pitanje 3: Obrazovanje x preferencija sadrzaja
tab3 <- table(survey$education, survey$content_preference)
chi3 <- chisq.test(tab3)
v3 <- sqrt(chi3$statistic / (sum(tab3) * (min(dim(tab3)) - 1)))

cat("=== PITANJE 3: Obrazovanje x Preferencija sadrzaja ===\n")
cat("chi2(", (nrow(tab3)-1)*(ncol(tab3)-1), ") = ", round(chi3$statistic, 2), 
    ", p = ", round(chi3$p.value, 4), ", V = ", round(v3, 3), "\n", sep = "")
cat("Interpretacija:", if_else(chi3$p.value < 0.05, 
    "Postoji znacajna veza.", 
    "Nema znacajne veze."), "\n")

# Vizualizacija
survey |>
  mutate(education = factor(education, levels = c("osnovna", "srednja", "visa", "visoka"))) |>
  count(education, content_preference) |>
  group_by(education) |>
  mutate(udio = n / sum(n)) |>
  ungroup() |>
  ggplot(aes(x = education, y = udio, fill = content_preference)) +
  geom_col(position = "dodge", alpha = 0.85) +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Preferencija sadrzaja po razini obrazovanja",
    subtitle = paste0("chi2 = ", round(chi3$statistic, 1), ", p = ", round(chi3$p.value, 3), 
                      ", V = ", round(v3, 2)),
    x = "Razina obrazovanja",
    y = "Udio",
    fill = "Sadrzaj"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

```{r}
#| label: analiza-sazetak
#| echo: true
#| message: false
#| warning: false

# Sazetak svih testova
cat("================================================\n")
cat("   SAZETAK ANALIZE KATEGORICKIH PODATAKA\n")
cat("================================================\n\n")

tibble(
  pitanje = c("Dob x Tip medija", "Regija x Dig./Trad.", "Obrazovanje x Sadrzaj"),
  chi2 = round(c(test_q1$statistic, test_q2$statistic, chi3$statistic), 1),
  df = c((nrow(tab1)-1)*(ncol(tab1)-1), (nrow(tab2)-1)*(ncol(tab2)-1), (nrow(tab3)-1)*(ncol(tab3)-1)),
  p = c(format(test_q1$p.value, scientific = TRUE, digits = 2),
        round(test_q2$p.value, 4), round(chi3$p.value, 4)),
  V = round(c(v1, v2, v3), 3),
  velicina = c(
    if_else(v1 > 0.29, "veliki", if_else(v1 > 0.17, "srednji", "mali")),
    if_else(v2 > 0.29, "veliki", if_else(v2 > 0.17, "srednji", "mali")),
    if_else(v3 > 0.29, "veliki", if_else(v3 > 0.17, "srednji", "mali"))
  )
)
```

Analiza otkriva jasan obrazac. Veza između dobi i tipa medija je najjača i najvažnija: generacijski jaz u medijskim navikama je velik i statistički nedvojben. Regionalne razlike u digitalnim vs tradicionalnim medijima su mnogo manje (ako uopće postoje). Veza obrazovanja i preferencije sadržaja varira ovisno o uzorku.

---

## Uobičajene pogreške i ograničenja {#sec-pogreske}

Hi-kvadrat testovi su jednostavni za provesti ali lako ih je krivo primijeniti ili interpretirati.

**Pogreška 1: Korištenje postotaka umjesto frekvencija.** Chi2 test zahtijeva frekvencije (apsolutne brojeve), ne postotke ili proporcije. `chisq.test(c(30, 20, 50))` je ispravno. `chisq.test(c(0.30, 0.20, 0.50))` će dati besmislene rezultate jer misli da ukupno imate 1 opažanje.

```{r}
#| label: pogreska-postoci
#| echo: true
#| message: false
#| warning: false

# KRIVO: postoci
cat("KRIVO (postoci):\n")
chisq.test(c(0.30, 0.20, 0.50))

cat("\nISPRAVNO (frekvencije):\n")
chisq.test(c(30, 20, 50))
```

**Pogreška 2: Pretjerana granularnost.** Tablica 10 x 8 s ukupno 100 opažanja imat će mnogo ćelija s malim frekvencijama. Bolje je spojiti kategorije i imati manje ali punije ćelije.

**Pogreška 3: Kauzalna interpretacija.** Chi2 test detektira asocijaciju (vezu), ne kauzalnost. Činjenica da su dob i medijski tip povezani ne znači da dob uzrokuje preferenciju (možda je obrazovanje, socioekonomski status ili kohorta efekt). Za kauzalne zaključke trebate eksperimentalni dizajn ili napredne metode.

**Pogreška 4: Zaboravljanje veličine učinka.** Kao i kod t-testa, p-vrijednost ovisi o veličini uzorka. S dovoljno velikim uzorkom, i trivijalna veza postaje "statistički značajna." Uvijek izvijestite Cramérovo V uz chi2 i p.

**Pogreška 5: Testiranje iste hipoteze više puta.** Ako testirate 10 parova varijabli, imate isti problem višestrukog testiranja kao kod t-testa. Koristite korekciju (Bonferroni ili BH).

```{r}
#| label: visestruko-chi
#| echo: true
#| message: false
#| warning: false

# Testiramo sve parove kategorickih varijabli
parovi <- list(
  c("age_group", "media_type"),
  c("age_group", "content_preference"),
  c("age_group", "media_grupa"),
  c("gender", "media_type"),
  c("gender", "content_preference"),
  c("education", "media_type"),
  c("education", "content_preference"),
  c("region", "media_grupa")
)

multi_chi <- map_df(parovi, \(par) {
  tab <- table(survey[[par[1]]], survey[[par[2]]])
  test <- chisq.test(tab)
  tibble(
    var1 = par[1],
    var2 = par[2],
    chi2 = round(test$statistic, 1),
    p = test$p.value
  )
}) |>
  mutate(
    p_adj = p.adjust(p, method = "BH"),
    znacajno_orig = p < 0.05,
    znacajno_adj = p_adj < 0.05
  ) |>
  arrange(p)

multi_chi |>
  mutate(p = format(p, scientific = TRUE, digits = 2),
         p_adj = format(p_adj, scientific = TRUE, digits = 2))
```

Nakon BH korekcije, možda se neki marginalno značajni rezultati izgube. Ovo je cijena korektnog pristupa višestrukom testiranju.

---

## Pomoćna funkcija za kompletni hi-kvadrat izvještaj {#sec-funkcija}

U praksi često ponavljamo iste korake za svaki par varijabli. Napišimo funkciju koja automatizira cijeli postupak.

```{r}
#| label: chi-funkcija
#| echo: true
#| message: false
#| warning: false

chi_izvjestaj <- function(data, var1, var2) {
  tab <- table(data[[var1]], data[[var2]])
  test <- chisq.test(tab)
  v <- sqrt(test$statistic / (sum(tab) * (min(dim(tab)) - 1)))
  min_exp <- min(test$expected)
  
  cat("======================================\n")
  cat(var1, "x", var2, "\n")
  cat("======================================\n")
  cat("Dimenzije tablice:", nrow(tab), "x", ncol(tab), "\n")
  cat("Najm. ocekivana frekvencija:", round(min_exp, 1), "\n")
  
  if (min_exp < 5) {
    cat("Ocekivane frekvencije < 5. Koristim Fisherov test.\n")
    fisher <- fisher.test(tab, simulate.p.value = TRUE)
    cat("P-vrijednost (Fisher):", round(fisher$p.value, 4), "\n")
  } else {
    cat("chi2(", (nrow(tab)-1)*(ncol(tab)-1), ") = ", 
        round(test$statistic, 2), "\n", sep = "")
    cat("P-vrijednost:", format(test$p.value, scientific = TRUE, digits = 3), "\n")
  }
  
  cat("Cramerovo V:", round(v, 3), "\n")
  cat("Odluka:", if_else(test$p.value < 0.05, 
    "Postoji statisticki znacajna veza.", 
    "Nema statisticki znacajne veze."), "\n\n")
  
  invisible(list(table = tab, test = test, V = v))
}

# Primjeri koristenja
chi_izvjestaj(survey, "age_group", "media_type")
chi_izvjestaj(survey, "gender", "content_preference")
```

Ova funkcija automatski provjerava pretpostavke, odabire odgovarajući test i računa veličinu učinka. Možete je koristiti u svim budućim analizama kategoričkih podataka.

---

## Pregled svih testova za kategoričke podatke {#sec-pregled}

```{r}
#| label: pregled-tablica
#| echo: true
#| message: false
#| warning: false

tribble(
  ~test, ~situacija, ~R_kod,
  "chi2 goodness-of-fit", "Jedna varijabla vs ocekivana distribucija", "chisq.test(frekvencije, p = proporcije)",
  "chi2 nezavisnosti", "Veza dviju kategorickih varijabli", "chisq.test(table(x, y))",
  "Fisherov egzaktni", "Male ocekivane frekvencije ili mali n", "fisher.test(table(x, y))",
  "McNemarov test", "Uparene kategoricke varijable", "mcnemar.test(table(prije, poslije))"
)
```

---

::: {.callout-important}
## Ključni zaključci

1. Hi-kvadrat testovi se koriste kad su varijable kategoričke. Test za dobrotu prilagodbe uspoređuje jednu varijablu s očekivanom distribucijom. Test nezavisnosti testira vezu dviju varijabli.

2. Chi2 statistika mjeri ukupno odstupanje opaženih od očekivanih frekvencija: chi2 = suma (O minus E)^2 / E. Veći chi2 = jači dokaz protiv H0.

3. Očekivane frekvencije pod H0 su E = (ukupno u retku puta ukupno u stupcu) / ukupno. Pretpostavka: sve E >= 5.

4. Standardizirani reziduali identificiraju specifične ćelije koje najviše doprinose vezi. |r| > 2 je značajno. Uvijek ih izvijestite jer chi2 sam ne govori gdje je veza najjača.

5. Cramérovo V mjeri jačinu veze (0 do 1). Za k = 4: V oko 0.06 mali, V oko 0.17 srednji, V oko 0.29 veliki učinak. Uvijek ga izvijestite uz chi2 i p.

6. Fisherov egzaktni test koristite kad su očekivane frekvencije < 5 ili je uzorak mali. Za 2x2 tablice automatski daje odds ratio.

7. Spajanje kategorija (kolapsiranje) je legitiman pristup kad su neke kategorije prerijetke. Digitalni vs tradicionalni mediji je informativnije od šest odvojenih kategorija.

8. Simpsonov paradoks upozorava da agregirani rezultati mogu biti obmanjujući. Uvijek provjerite rezultate stratificirane po relevantnoj trećoj varijabli.

9. McNemarov test je za uparene kategoričke podatke (isti ispitanici, dva mjerenja). Ekvivalent uparenom t-testu za kategoričke varijable.

10. Hi-kvadrat test detektira asocijaciju, ne kauzalnost. Veza dobi i medijskog tipa ne znači da dob uzrokuje preferenciju.

11. Višestruko testiranje je problem i kod hi-kvadrat testova. Koristite BH ili Bonferroni korekciju kad testirate mnogo parova varijabli.

12. Kompletni izvještaj uključuje kontingencijsku tablicu, vizualizaciju (stacked/dodged barplot), chi2 s df i p, Cramérovo V s interpretacijom, reziduale za specifična odstupanja i praktičnu interpretaciju u kontekstu istraživačkog pitanja.
:::

---

## Zadaci za pripremu

1. Učitajte `media_survey_chi2.csv`. Testirajte postoji li veza između regije i preferencije sadržaja (`content_preference`). Izračunajte Cramérovo V i interpretirajte ga. Koji reziduali su najjači?

2. Kreirajte novu varijablu `zadovoljni` (satisfaction >= 4 = "da", inače "ne"). Testirajte postoji li veza između `media_grupa` (digitalni/tradicionalni) i `zadovoljni` pomoću Fisherovog egzaktnog testa. Interpretirajte odds ratio.

3. Napišite funkciju `chi_vizualizacija(data, var1, var2)` koja prima podatke i imena dviju varijabli te automatski crta grupani barplot s rezultatima testa u podnaslovu.

---

## Dodatno čitanje

**Obavezno**

Navarro, D. (2018). *Learning Statistics with R*, Chapter 12 (Categorical Data Analysis). Besplatno dostupno na [learningstatisticswithr.com](https://learningstatisticswithr.com/lsr-0.6.pdf). Pokriva hi-kvadrat testove s R kodom.

**Preporučeno**

Agresti, A. (2018). *An Introduction to Categorical Data Analysis* (3rd edition). Wiley. Poglavlja 1-3. Referentni udžbenik za kategoričke podatke.

Wickham, H. & Grolemund, G. (2017). *R for Data Science*. O'Reilly. Besplatno na [r4ds.had.co.nz](https://r4ds.had.co.nz). Poglavlja o faktorima i vizualizaciji kategoričkih podataka.

---

## Pojmovnik

| Pojam | Objašnjenje |
|---|---|
| Kategorička varijabla | Varijabla čije su vrijednosti kategorije (npr. spol, regija, tip medija). Nema smisleni numerički poredak (nominalna) ili ima (ordinalna). |
| Kontingencijska tablica | Tablica frekvencija za sve kombinacije dviju kategoričkih varijabli. Temelj za test nezavisnosti. |
| Hi-kvadrat statistika | Mjera ukupnog odstupanja opaženih od očekivanih frekvencija. |
| Goodness-of-fit test | Testira odgovara li distribucija jedne varijable očekivanoj distribuciji. df = k minus 1. |
| Test nezavisnosti | Testira postoji li veza između dviju kategoričkih varijabli. df = (r minus 1)(c minus 1). |
| Očekivana frekvencija | Frekvencija pod H0. Za test nezavisnosti: E = (redak total puta stupac total) / ukupno. |
| Standardizirani rezidual | (O minus E) / korijen(E). Doprinos svake ćelije ukupnom chi2. Značajno ako |r| > 2. |
| Cramérovo V | Mjera veličine učinka za hi-kvadrat test. V = korijen(chi2/(n(k minus 1))). Raspon 0 do 1. |
| Fisherov egzaktni test | Točan test za male uzorke ili male očekivane frekvencije. Ne koristi chi2 aproksimaciju. |
| Odds ratio (omjer šansi) | Mjera asocijacije za 2x2 tablice. OR = 1 znači nema veze. OR > 1 ili < 1 znači veza postoji. |
| Yatesova korekcija | Korekcija kontinuiteta za 2x2 tablice. R je primjenjuje po defaultu u `chisq.test()`. |
| McNemarov test | Test za uparene kategoričke podatke (isti ispitanici, dva mjerenja). |
| Simpsonov paradoks | Smjer veze se promijeni kad kontroliramo treću varijablu. Agregirani rezultati obmanjuju. |
| Stratificirana analiza | Provođenje testa odvojeno za podgrupe treće varijable. Otkriva Simpsonov paradoks. |
| Spajanje kategorija | Kolapsiranje rijetkih kategorija u šire grupe. Povećava očekivane frekvencije i preglednost. |
| `chisq.test()` | R funkcija za hi-kvadrat test. Prima vektor frekvencija (gof) ili kontingencijsku tablicu. |
| `fisher.test()` | R funkcija za Fisherov egzaktni test. Prima kontingencijsku tablicu. |
| `mcnemar.test()` | R funkcija za McNemarov test. Prima 2x2 tablicu uparenih podataka. |
| `table()` | R funkcija za kreiranje kontingencijske tablice. `table(x, y)` za dvije varijable. |
| `prop.table()` | Pretvara frekvencije u proporcije. `margin = 1` za retke, `margin = 2` za stupce. |
| `p.adjust()` | Korekcija p-vrijednosti za višestruko testiranje. `method = "BH"` je preporučen. |
